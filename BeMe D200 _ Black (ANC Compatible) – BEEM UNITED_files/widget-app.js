var reportError=function(exception){var host;if(window.ENV&&window.ENV.apiPrefix)host=window.ENV.apiPrefix;else{if("undefined"==typeof WIDGET_HOST)return;host=WIDGET_HOST+"/rest/"}var queryParam=encodeURIComponent("exception")+"="+encodeURIComponent(exception?exception.message+"\n"+exception.stack:""),myImage=new Image(1,2);throw myImage.src=host+"system/ui-errors?"+queryParam,exception},MessageFactory=function(ORIGIN_REGEX,TARGET_WINDOW){var self=this,REPLY_REGEX=/^REPLY_(\d+)$/;this.handlers={},this.messages={},this.send=function(type,content,callback){var randomNum=Math.floor(1e3*Math.random()+1),message={type:type,content:content,id:Date.now()+randomNum,isProonto:!0};self.messages[message.id]={data:message,callback:callback},"object"==typeof TARGET_WINDOW&&TARGET_WINDOW.postMessage(message,"*")};var handleMessage=function(event){var receivedMessage=event.data;if(REPLY_REGEX.test(receivedMessage)){var matches=REPLY_REGEX.exec(receivedMessage);if(!matches)return;var messageId=matches[1],sentMessage=self.messages[messageId];if(!sentMessage)return;if(sentMessage.callback)try{sentMessage.callback()}catch(e){reportError(e)}return void delete self.messages[messageId]}if(receivedMessage.isProonto){var handlers=self.handlers[receivedMessage.type];if(handlers)for(var i=0;i<handlers.length;i++)try{handlers[i](receivedMessage.content)}catch(e){reportError(e)}event.source.postMessage("REPLY_"+receivedMessage.id,event.origin)}};this.on=function(type,fn){self.handlers[type]||(self.handlers[type]=[]);for(var handlers=self.handlers[type],i=0,len=handlers.length;len>i;i++)if(handlers[i]===fn)return!1;return handlers.push(fn),!0},this.off=function(type,fn){if(self.handlers[type]){for(var handlers=self.handlers[type],i=0,len=handlers.length;len>i;i++)if(handlers[i]===fn)return handlers.splice(i,1),!0;return!1}},window.addEventListener?window.addEventListener("message",handleMessage,!1):window.attachEvent&&window.attachEvent("onmessage",handleMessage)};MessageFactory.prototype.toWidget={widgetLoad:"WIDGET_LOAD",customButton:"CUSTOM_BUTTON",messageClick:"MESSAGE_CLICK",newState:"NEW_STATE",blockClient:"BLOCK_CLIENT",contactDetailsEntered:"CONTACT_DETAILS_ENTERED",resize:"DO_RESIZE",setWidgetFocusState:"SET_WIDGET_FOCUS_STATE",calcTitleAnimation:"CALC_TITLE_ANIMATION",onChatMessage:"ON_CHAT_MESSAGE",expandWidget:"SCROLL_TO_BOTTOM",collapseWidget:"SCROLL_BACK",findWidget:"FIND_WIDGET",sendFocus:"SEND_FOCUS",sendBlur:"SEND_BLUR",onClientAction:{name:"ON_CLIENT_ACTION",events:{ACCEPT_INVITATION:"Visitor accepted invitation",UPDATE_NAME:"Visitor updated his name",CONTACT_DETAILS_ENTERED:"Visitor filled contact details",CLICK_CALL:"Visitor started a phone call",REQUEST_VIDEO:"Visitor requested a video chat",REQUEST_AUDIO:"Visitor requested an audio chat",CLICK_CHAT:"Live chat clicked"}},onClientFeedback:"ON_CLIENT_FEEDBACK",onAgentApproach:"ON_AGENT_APPROACH"},MessageFactory.prototype.toHost={openChat:"OPEN_CHAT",openPhonePanel:"OPEN_PHONE_PANEL",openAudioChat:"OPEN_AUDIO_CHAT",setClientDetails:"SET_CLIENT_DETAILS",setCustomClientId:"CUSTOM_CLIENT_ID",sendEvent:"SEND_CLIENT_EVENT",sendIdleMode:"SET_IDLE_MODE",playSound:"PLAY_SOUND",hideWidgetOnPage:"HIDE_WIDGET_ON_PAGE",parentParams:"PARENT_PARAMS"};var DisplayForm={none:"NONE",onlineEntrance:"ONLINE_ENTRANCE",onlineChat:"ONLINE_CHAT",contactDetails:"CONTACT_DETAILS",chatInvitation:"CHAT_INVITATION",chatLeadForm:"CHAT_LEAD_FORM"},DEVICE_TYPES={DESKTOP:"desktop",TABLET:"tablet",SMARTPHONE:"smartphone"};window.ENV={name:"dev",urlPrefix:"/chat/",apiPrefix:"http://localhost:9002/chat/rest/",agentPics:"https://proonto-users.s3.amazonaws.com/profile-photo/"},window.ENV.name="prod",window.ENV.apiPrefix="https://chat.proonto.com/chat/rest/",angular.module("global",[]).constant("ERRORS",{api:{count:0,treshold:5},fatal:!1}),angular.module("proonto.app",["proonto.user","proonto.api","proonto.ui","proonto.chat","proonto.video","proonto.agent","proonto.cache","proonto.utils","global","ngAnimate","ngFitText","ngSanitize","pascalprecht.translate"]),angular.module("proonto.app").constant("CONFIG",{minPollDelay:50,pollErrorDelay:3e3,maxClientPages:5,soundPlayThrottle:4e3,soundFiles:{ogg:"assets/notification-sound.ogg",mp3:"assets/notification-sound.mp3"},companyId:function(match){return match?match[1]:null}(location.search.match(/c=(\d+)/)),url:function(match){return match?decodeURIComponent(match[1]):null}(location.search.match(/u=([^&\s]+)/)),referrer:function(match){return match?decodeURIComponent(match[1]):null}(location.search.match(/r=([^&\s]+)/)),demo:function(match){return match?match[1]:null}(location.search.match(/d=([^&\s]+)/)),noTracking:function(match){return match?match[1]:null}(location.search.match(/noTracking=([^&\s]+)/)),whiteLabelWidget:function(match){return match?match[1]:null}(location.search.match(/whiteLabelWidget=([^&\s]+)/)),screenType:function(match){return match?match[1]:null}(location.search.match(/screenType=([^&\s]+)/)),clientId:function(match){return match?match[1]:null}(location.search.match(/clientId=([^&\s]+)/)),unqiueId:function(match){return match?match[1]:null}(location.search.match(/uniqueId=([^&\s]+)/)),clientName:function(match){return match?decodeURIComponent(match[1]):null}(location.search.match(/clientName=([^&\s]+)/)),cookiesEnabled:function(match){return match?match[1]:null}(location.search.match(/cookiesEnabled=([^&\s]+)/)),pageTitle:function(match){return match?decodeURIComponent(match[1]):null}(location.search.match(/t=([^&\s]+)/)),ENV:{env:window.ENV.name,urlPrefix:window.ENV.urlPrefix,apiPrefix:window.ENV.apiPrefix,agentPics:window.ENV.agentPics},intlTelInput:{utilsScript:"lib/intl-tel-input/lib/libphonenumber/build/utils.js"}}).config(["$httpProvider","$locationProvider","$translateProvider",function($httpProvider,$locationProvider,$translateProvider){$httpProvider.interceptors.push(["$q",function($q){return{request:function(config){return config},requestError:function(rejection){return $q.reject(rejection)},response:function(response){return response},responseError:function(rejection){return $q.reject(rejection)}}}]),$translateProvider.useStaticFilesLoader({prefix:"i18n/locale-",suffix:".json"}).useSanitizeValueStrategy("escape")}]).config(["$provide",function($provide){$provide.decorator("$exceptionHandler",["$delegate",function($delegate){return function(exception,cause){$delegate(exception,cause)}}])}]).factory("PubsubFactory",["$rootScope",function($rootScope){var pubsub={};return pubsub.emit=function(msg,data){$rootScope.$emit(msg,data)},pubsub.on=function(msg,scope,func){var unbind=$rootScope.$on(msg,func);scope&&scope.$on("$destroy",unbind)},pubsub}]).run(["$rootScope","VideoFactory","AgentFactory","$translate",function($rootScope,Video,Agent,$translate){$rootScope.Message=new MessageFactory(/.*/g,window.parent)}]).controller("AppController",["$rootScope","$scope","$timeout","ApiFactory","CONFIG","PubsubFactory","CLIENT_ACTIONS","AGENT_ACTIONS","ChatFactory","CacheFactory","CACHE_ENTRIES","VideoFactory","AgentFactory","$translate","$q",function($rootScope,$scope,$timeout,Api,CONFIG,Pubsub,CLIENT_ACTIONS,AGENT_ACTIONS,Chat,Cache,CACHE_ENTRIES,Video,AgentFactory,$translate,$q){function addClass(classList,newClass){return"undefined"==typeof newClass?classList:-1!==classList.indexOf(newClass)||-1!==classList.indexOf(newClass+" ")||-1!==classList.indexOf(" "+newClass)?classList:(0!==classList.length&&(classList+=" "),classList+=newClass)}function addClassByUserAgent(){$rootScope.GLOBALS.isMobileUA?$scope.appClass=addClass($scope.appClass,"mobile-ua"):$rootScope.GLOBALS.isTabletUA?$scope.appClass=addClass($scope.appClass,"tablet-ua"):$scope.appClass=addClass($scope.appClass,"desktop-ua")}function addAndroidStockClass(){$rootScope.GLOBALS.isStockAndroid&&($scope.appClass=addClass($scope.appClass,"android-stock"))}function setAppClass(){$scope.appClass=addClass($scope.appClass,CONFIG.screenType),addClassByUserAgent(),addAndroidStockClass(),$scope.appClass=addClass($scope.appClass,$rootScope.GLOBALS.online?"online":"offline")}function openChat(){$scope.$apply(function(){$scope.openChat()})}function initSound(){var source=document.createElement("source");sound.canPlayType("audio/mpeg;")?(source.type="audio/mpeg",source.src=CONFIG.soundFiles.mp3):(source.type="audio/ogg",source.src=CONFIG.soundFiles.ogg),sound.appendChild(source)}function playSound(){"true"!==CONFIG.demo&&soundEnabled!==!1&&sound.play()}function openPhonePanel(){$scope.$apply(function(){$scope.openPhoneCall(!0)})}function openAudioChat(){$scope.$apply(function(){$scope.openAudioChat(!0)})}function getBrowserInfo(){var tem,ua=navigator.userAgent,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(M[1])?(tem=/\brv[ :]+(\d+)/g.exec(ua)||[],{name:"IE ",version:tem[1]||""}):"Chrome"===M[1]&&(tem=ua.match(/\bOPR\/(\d+)/),null!==tem)?{name:"Opera",version:tem[1]}:(M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(tem=ua.match(/version\/(\d+)/i))&&M.splice(1,1,tem[1]),{name:M[0],version:M[1]})}function updateWidgetSize(newState){Message.send(Message.toWidget.newState,newState,function(){})}function setShowLeadFrom(showLeadForm){$rootScope.DISPLAY.showLeadForm=showLeadForm}function nullSafe(val){return val?val:""}function setClientLocation(){var clientLocation=Cache.get("prt_clientLocation");return clientLocation?void Api.postInitialization(clientLocation):void $.ajax({type:"GET",crossDomain:!0,dataType:"jsonp",url:"//freegeoip.net/json/",success:function(geoLocationInfo){var formattedGeoLocation={countryCode:nullSafe(geoLocationInfo.country_code),countryName:nullSafe(geoLocationInfo.country_name),cityName:nullSafe(geoLocationInfo.city),regionName:nullSafe(geoLocationInfo.region_name),timeZone:nullSafe(geoLocationInfo.time_zone)};Api.postInitialization(formattedGeoLocation),Cache.set("prt_clientLocation",formattedGeoLocation,18e3)}})}function notifyWidgetLoaded(){$rootScope.Message.send($rootScope.Message.toWidget.widgetLoad,{companyId:CONFIG.companyId,controlGroup:$rootScope.GLOBALS.controlGroup,clientId:Api.clientId,uniqueId:Api.uniqueId,isAgentOnline:$rootScope.GLOBALS.online,clientName:Api.clientName},function(){})}function watchFeedback(){AgentFactory.agent.agentId&&Chat.customerFeedback.getFeedback(AgentFactory.agent.agentId),$scope.$watch(function(){return AgentFactory.agent.agentId},function(newVal,oldVal){newVal&&newVal!==oldVal&&Chat.customerFeedback.getFeedback(AgentFactory.agent.agentId)})}function getInitialChats(){Chat.getChatHistory().then(function(response){response.data&&response.data.length>0&&($rootScope.GLOBALS.firstAgentMessage=!1,setShowLeadFrom(!1),watchFeedback())})}function translateTimeDayForEngagements(){var translations=["time.MORNING","time.EVENING","time.AFTERNOON","time.NIGHT",""];$rootScope.dayTimeTranslations={},$translate(translations).then(function(returnedVal){$rootScope.dayTimeTranslations["time.MORNING"]=returnedVal["time.MORNING"],$rootScope.dayTimeTranslations["time.EVENING"]=returnedVal["time.EVENING"],$rootScope.dayTimeTranslations["time.AFTERNOON"]=returnedVal["time.AFTERNOON"],$rootScope.dayTimeTranslations["time.NIGHT"]=returnedVal["time.NIGHT"]})}function getDisplayState(){var displayState=Cache.get(CACHE_ENTRIES.displayState);return null===displayState&&$rootScope.DISPLAY.stealthMode?DisplayForm.none:$rootScope.GLOBALS.isMobileUA&&!$rootScope.DISPLAY.isShowOnMobile?DisplayForm.none:"true"===CONFIG.demo?DisplayForm.onlineEntrance:displayState===DisplayForm.onlineChat&&$rootScope.GLOBALS.online===!0?displayState:$scope.getInitialState()}function setClientDetailsFromApi(clientDetails){$scope.$apply(function(){$scope.innerSetClientDetails(clientDetails,clientDetails.sendNotification)})}function sendClientEvent(eventData){Api.sendClientEvent(eventData)}function setCustomClientIdFromApi(customId){Api.sendCustomClientId(customId)}function hideWidgetOnPage(showOnEngagments){$rootScope.GLOBALS.hideWidgetbyApi=!0,$rootScope.GLOBALS.showWidgetOnEngamgent=showOnEngagments,$scope.switchDisplay(DisplayForm.none)}function setIdleMode(){$scope.$apply(function(){Api.pauseUpdates(),$scope.switchDisplay(DisplayForm.none)})}function sendWidgetFocusState(widgetFocusState){$rootScope.Message.send($rootScope.Message.toWidget.setWidgetFocusState,widgetFocusState,function(){})}function calcTitleAnimation(){$rootScope.Message.send($rootScope.Message.toWidget.calcTitleAnimation,null,function(){})}$rootScope.GLOBALS={initialized:!1,online:!1,showVideoPanel:!1,showPhonePanel:!1,messageCenter:null,clientName:"me",clientEmail:null,deviceTypeUA:DeviceCheck.deviceType(),isDesktopUA:DeviceCheck.deviceType()===DeviceCheck.DeviceTypes.DESKTOP,isTabletUA:DeviceCheck.deviceType()===DeviceCheck.DeviceTypes.TABLET,isMobileUA:DeviceCheck.deviceType()===DeviceCheck.DeviceTypes.MOBILE,isStockAndroid:DeviceCheck.isStockAndroid(),isS3:DeviceCheck.isS3(),isiOSlt8:DeviceCheck.isiOSlt8(),isiOs:DeviceCheck.isiOS(),displayState:DisplayForm.none,hideWidgetbyApi:!1,firstAgentMessage:!0,blinkForNewMessage:!1,badge:!1,badgeValue:Cache.get(CACHE_ENTRIES.unreadMsg),isKeyboardOpen:!1,parentParamsObj:{}},$rootScope.DISPLAY={brandName:"",callMeText:"",callMeTitle:"",offlineFormText:"",offlineFormTitle:"",mainColor:"",host:"",id:-1,invitationText:"",onlineButtonText:"",offlineButtonText:"",secondaryColor:"",showLeadForm:!1,telephone:"",showPhoneBtn:!0,tertiaryColor:"",viewMode:"",isLanguageRTL:!1,isShowOnMobile:null,disableVideo:null},$scope.customAppStyles={},$rootScope.percToPx=function(perc,dir){var px;switch(dir){case"height":px=perc*$rootScope.GLOBALS.parentParamsObj.height/100+"px";break;case"width":px=perc*$rootScope.GLOBALS.parentParamsObj.width/100+"px"}return px},$rootScope.GLOBALS.isMobileUA&&($scope.customAppStyles.height=$rootScope.percToPx(92,"height"),$scope.customAppStyles.marginTop=$rootScope.percToPx(4,"height")),$rootScope.bindEvent=function(event,target,callback,args){args=args||[];var jqTarget=angular.element(target);jqTarget.bind(event,function(eventObject){var argsWithEvent=args.slice();argsWithEvent.push(eventObject),$scope.$apply(callback.apply($scope,argsWithEvent))}),jqTarget.on("$destroy",function(){jqTarget.off(event,callback)})},$scope.appClass="",$scope.customerFeedback={isOpened:!1,userClosed:!1},$scope.DISPLAY.isLanguageRTL&&($scope.appClass=addClass($scope.appClass,"rtl"));var Message=$rootScope.Message,sound=new Audio,soundEnabled=!0;$scope.isVideoConnected=!1,$scope.DisplayForm=DisplayForm,initSound(),Pubsub.on(Api.EVENTS.onlineStatus,null,function(event,msgDetails){null!==msgDetails&&($rootScope.GLOBALS.online=msgDetails,$rootScope.GLOBALS.online===!0&&$rootScope.GLOBALS.displayState===DisplayForm.contactDetails?($rootScope.GLOBALS.displayState=DisplayForm.onlineChat,updateWidgetSize(DisplayForm.onlineChat)):$rootScope.GLOBALS.online===!1&&$rootScope.GLOBALS.displayState===DisplayForm.onlineChat&&($rootScope.GLOBALS.displayState=DisplayForm.contactDetails,updateWidgetSize(DisplayForm.contactDetails)))}),Pubsub.on(Api.EVENTS.startVideoChat,null,function(event,msgDetails){return OT&&OT.checkSystemRequirements()?($rootScope.GLOBALS.showVideoPanel=!0,calcTitleAnimation(),$scope.isVideoConnected=!0,$rootScope.GLOBALS.displayState!==DisplayForm.onlineChat&&$scope.openChat(),void playSound()):void Chat.sendAction(CLIENT_ACTIONS.chatVideoDeviceNotSupported)}),Pubsub.on(Api.EVENTS.endVideoChat,null,function(event,msgDetails){$rootScope.GLOBALS.showVideoPanel=!1,$scope.isVideoConnected=!1});var browser=getBrowserInfo();$scope.switchDisplay=function(newState){return browser.name.toLowerCase().indexOf("msie")>-1&&browser.version<10?($rootScope.GLOBALS.displayState=DisplayForm.none,void updateWidgetSize(DisplayForm.none)):$rootScope.GLOBALS.isS3&&$rootScope.GLOBALS.isStockAndroid?(Api.pauseUpdates(),$rootScope.GLOBALS.displayState=DisplayForm.none,void updateWidgetSize(DisplayForm.none)):void($rootScope.GLOBALS.displayState!==newState&&($rootScope.GLOBALS.displayState=newState,updateWidgetSize(newState)))},$scope.closeChat=function(){$scope.GLOBALS.showVideoPanel===!0?(Video.closeVideo(),Chat.sendAction(CLIENT_ACTIONS.closeVideo)):$scope.GLOBALS.showPhonePanel===!0?$scope.GLOBALS.showPhonePanel=!1:$scope.GLOBALS.showVideoPanel===!1&&($scope.switchDisplay($scope.getInitialState()),Cache.set(CACHE_ENTRIES.displayState,$scope.getInitialState(),40),Chat.sendAction(CLIENT_ACTIONS.closeChat)),$rootScope.GLOBALS.isKeyboardOpen=!1},$rootScope.$watch("GLOBALS.parentParamsObj",function(newHostVals){void 0!==newHostVals.width&&($rootScope.GLOBALS.isMobileUA=newHostVals.width<600,$rootScope.GLOBALS.isTabletUA=newHostVals.width>600&&newHostVals.width<1024,$rootScope.GLOBALS.isDesktopUA=newHostVals.width>1024,setAppClass())}),Api.initialize().then(function(response){angular.extend($rootScope.DISPLAY,response.data.displayDetails),$rootScope.DISPLAY.isShowOnMobile=response.data.isShowOnMobile,$rootScope.DISPLAY.showPhoneBtn=response.data.enablePhone,$rootScope.DISPLAY.disableVideo=response.data.disableVideo,$rootScope.DISPLAY.stealthMode=response.data.stealthMode,$rootScope.DISPLAY.telephone=response.data.phone,$rootScope.phoneNumber=response.data.phone,soundEnabled=response.data.enableSound,$rootScope.GLOBALS.online=response.data.online;var phrase=$rootScope.GLOBALS.online?response.data.displayDetails.onlineButtonText:response.data.displayDetails.offlineButtonText;"classic"!==response.data.displayDetails.shape&&$scope.setCustomButton(phrase.length),$rootScope.GLOBALS.displayState=getDisplayState();var deferred=$q.defer();$translate.use($rootScope.DISPLAY.language).then(function(){deferred.resolve(),translateTimeDayForEngagements()}),$translate.refresh(),notifyWidgetLoaded(),updateWidgetSize($rootScope.GLOBALS.displayState),setAppClass(),$rootScope.GLOBALS.companyName=response.data.companyName,response.data.name?$rootScope.GLOBALS.clientName=response.data.name:$rootScope.GLOBALS.clientName="me",$rootScope.GLOBALS.clientEmail=response.data.email,response.data.online&&$timeout(function(){getInitialChats()}),$(window).bind("beforeunload",function(){Api.stopUpdates()}),Api.startUpdates(),setClientLocation(),browser.name.toLowerCase().indexOf("msie")>-1&&browser.version<10&&$scope.switchDisplay(DisplayForm.none),$rootScope.GLOBALS.isS3&&$rootScope.GLOBALS.isStockAndroid&&($scope.switchDisplay(DisplayForm.none),Api.pauseUpdates())}),$scope.getInitialState=function(){return $rootScope.DISPLAY.stealthMode?DisplayForm.none:DisplayForm.onlineEntrance},Pubsub.on(Api.EVENTS.openInvitation,null,function(event,message){return $rootScope.GLOBALS.isMobileUA?void Chat.sendAction(CLIENT_ACTIONS.chatInviteDisabledOnMobile):void($rootScope.GLOBALS.displayState===DisplayForm.onlineChat?Chat.sendAction(CLIENT_ACTIONS.chatAlreadyOpen):(setShowLeadFrom(!1),$rootScope.DISPLAY.invitationText=message.data,$scope.switchDisplay(DisplayForm.chatInvitation),Chat.sendAction(CLIENT_ACTIONS.chatInvite),playSound(),calcTitleAnimation()))}),Pubsub.on(Api.EVENTS.blockClient,null,function(event,message){Message.send(Message.toWidget.blockClient,null,function(){$scope.$apply(function(){Api.pauseUpdates(),$scope.switchDisplay(DisplayForm.none)})})}),Pubsub.on(Api.EVENTS.openChat,null,function(event,message){setShowLeadFrom(!1),$scope.openChat(!0),$rootScope.GLOBALS.firstAgentMessage=!1,calcTitleAnimation()}),Pubsub.on(Api.EVENTS.gotAgentUpdates,null,function(event,agentDetails){agentDetails.agentId>0&&!$rootScope.GLOBALS.online&&!agentDetails.duringInitialization&&($rootScope.GLOBALS.online=!0,getInitialChats())}),$scope.openChat=function(byAgent,byChatMsg){var newDisplay=null;$rootScope.GLOBALS.online?byChatMsg&&$rootScope.GLOBALS.firstAgentMessage?(setShowLeadFrom(!1),$scope.displayState!==DisplayForm.onlineChat&&(newDisplay=DisplayForm.onlineChat,Cache.set(CACHE_ENTRIES.displayState,DisplayForm.onlineChat,40),$scope.switchDisplay(newDisplay)),playSound()):$rootScope.DISPLAY.showLeadForm&&!$rootScope.GLOBALS.clientEmail?(newDisplay=DisplayForm.chatLeadForm,$scope.switchDisplay(newDisplay),Chat.sendAction(byAgent?CLIENT_ACTIONS.chatOpened:CLIENT_ACTIONS.clickChat)):$rootScope.GLOBALS.displayState===DisplayForm.onlineChat?Chat.sendAction(CLIENT_ACTIONS.chatAlreadyOpen):(newDisplay=DisplayForm.onlineChat,Cache.set(CACHE_ENTRIES.displayState,DisplayForm.onlineChat,40),$scope.switchDisplay(newDisplay),Chat.sendAction(byAgent?CLIENT_ACTIONS.chatOpened:CLIENT_ACTIONS.clickChat),$rootScope.GLOBALS.badgeValue=0,Cache.set(CACHE_ENTRIES.unreadMsg,$rootScope.GLOBALS.badgeValue,3600)):(newDisplay=DisplayForm.contactDetails,$scope.switchDisplay(newDisplay),Chat.sendAction(CLIENT_ACTIONS.clickContact))},$scope.innerSetClientDetails=function(clientDetails,sendNotification){var contactDetailsResult=Api.sendContactDetails(clientDetails.name,clientDetails.email,clientDetails.phone,clientDetails.msg,sendNotification);return Message.send(Message.toWidget.contactDetailsEntered,clientDetails,function(){}),Api.sendMessageToHostingSite(CLIENT_ACTIONS.contactDetailsEntered),contactDetailsResult},$scope.scrollToBottom=function(){Message.send(Message.toWidget.scrollToBottom,null,function(){})},$scope.scrollBack=function(){Message.send(Message.toWidget.scrollBack,null,function(){})},$scope.resizeIframe=function(newHeight){Message.send(Message.toWidget.resize,newHeight,function(){})},$rootScope.$on("actualCustomButtonWidth",function(e,width){$scope.setCustomButton(width)}),$scope.setCustomButton=function(length){Message.send("CUSTOM_BUTTON",length,function(){})},Pubsub.on(Api.EVENTS.showInMessageCenter,null,function(event,message){$scope.showInMessageCenter(message)}),Pubsub.on(Api.EVENTS.agentIsTyping,null,function(event){var translations=["actions.IS_TYPING"];$translate(translations).then(function(returnedVal){var agentName=AgentFactory.agent.agentName;"he"===$rootScope.DISPLAY.language&&(agentName=AgentFactory.agent.foreignName),$scope.showInMessageCenter(agentName+" "+returnedVal["actions.IS_TYPING"]+"...")})}),Pubsub.on(Api.EVENTS.gotChatUpdates,null,function(event,message){"TEXT"===message.messageType&&"AGENT"===message.senderType?(calcTitleAnimation(),$rootScope.GLOBALS.firstAgentMessage&&!$rootScope.GLOBALS.isMobileUA?($scope.openChat(!0,!0),$rootScope.GLOBALS.firstAgentMessage=!1):$rootScope.GLOBALS.displayState===DisplayForm.onlineEntrance&&($rootScope.GLOBALS.badgeValue++,Cache.set(CACHE_ENTRIES.unreadMsg,$rootScope.GLOBALS.badgeValue,3600),$rootScope.GLOBALS.blinkForNewMessage=!0,$timeout(function(){$rootScope.GLOBALS.blinkForNewMessage=!1},8e3))):"ACTION"===message.messageType&&message.data===AGENT_ACTIONS.openContactUsForm&&playSound()}),$scope.showInMessageCenter=function(message){$rootScope.GLOBALS.messageCenter=message,$scope.clearMessage&&$timeout.cancel($scope.clearMessage),$scope.clearMessage=$timeout(function(){$rootScope.GLOBALS.messageCenter=null},2e3)},$scope.validateEmailFormat=function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)},$scope.validatePhoneFormat=function(phone){for(var re=/[+()0-9]/,idx=0;idx<phone.length;idx++)if(!re.test(phone[idx]))return!1;return!0},$rootScope.sendFocus=function(e){$rootScope.GLOBALS.isMobileUA&&!$rootScope.GLOBALS.isTabletUA&&($rootScope.GLOBALS.isKeyboardOpen=!0)},$rootScope.sendBlur=function(e){$rootScope.GLOBALS.isMobileUA&&!$rootScope.GLOBALS.isTabletUA&&($rootScope.GLOBALS.isKeyboardOpen=!1)},angular.element(window).on("focus",function(e){sendWidgetFocusState(!0)}),angular.element(window).on("blur",function(e){sendWidgetFocusState(!1)}),$scope.openVideoChat=function(on){$rootScope.GLOBALS.showPhonePanel=!1,$rootScope.GLOBALS.showVideoPanel=on,$scope.buttonsStyle={border:"1px solid white","margin-left":"0px"},Video.cameraActive=on,Video.micActive=on,Chat.sendAction(CLIENT_ACTIONS.requestVideo)},$scope.openAudioChat=function(on){$rootScope.GLOBALS.showPhonePanel=!1,$rootScope.GLOBALS.showVideoPanel=on,Video.cameraActive=!1,Video.micActive=on,Chat.sendAction(CLIENT_ACTIONS.requestAudio)},$scope.openPhoneCall=function(on){$rootScope.GLOBALS.showVideoPanel=!1,$rootScope.GLOBALS.showPhonePanel=on};var parentParams=function(params){$rootScope.GLOBALS.parentParamsObj=params,$rootScope.GLOBALS.isMobileUA&&$rootScope.$emit("updateViewport")};Message.on(Message.toHost.openChat,openChat),Message.on(Message.toHost.openPhonePanel,openPhonePanel),Message.on(Message.toHost.openAudioChat,openAudioChat),Message.on(Message.toHost.setClientDetails,setClientDetailsFromApi),Message.on(Message.toHost.setCustomClientId,setCustomClientIdFromApi),Message.on(Message.toHost.sendEvent,sendClientEvent),Message.on(Message.toHost.hideWidgetOnPage,hideWidgetOnPage),Message.on(Message.toHost.sendIdleMode,setIdleMode),Message.on(Message.toHost.playSound,playSound),Message.on(Message.toHost.parentParams,parentParams)}]),angular.module("proonto.api",[]),angular.module("proonto.api").constant("API_EVENTS",{gotChatUpdates:"event.api.gotChatUpdates",gotAgentUpdates:"event.api.gotAgentUpdates",gotSnapshot:"event.api.gotSnapshot",startVideoChat:"event.api.startVideoChat",endVideoChat:"event.api.endVideoChat",showInMessageCenter:"event.api.showInMessageCenter",openInvitation:"event.api.openInvitation",openChat:"event.api.openChat",playSound:"event.api.playSound",agentIsTyping:"event.api.agentIsTyping",onlineStatus:"event.api.onlineStatus",blockClient:"event.api.blockClient",allOnlineAgentList:"event.api.allOnlineAgentList",agentChange:"event.api.agentChange"}).constant("AGENT_ACTIONS",{agentTyping:"TYPING",agentStopTyping:"STOP_TYPING",openChat:"OPEN_CHAT",openContactUsForm:"OPEN_CONTACT_US_FORM",startVideo:"START_VIDEO",openInvitation:"OPEN_INVITATION",lockClient:"LOCK_CLIENT",freeClient:"FREE_CLIENT",blockClient:"BLOCK_CLIENT"}).factory("RealApiFactory",["$rootScope","$http","$timeout","$q","PubsubFactory","API_EVENTS","CONFIG","ERRORS","CacheFactory","CACHE_ENTRIES","AGENT_ACTIONS","$translate",function($rootScope,$http,$timeout,$q,Pubsub,API_EVENTS,CONFIG,ERRORS,Cache,CACHE_ENTRIES,AGENT_ACTIONS,$translate){function makeUrl(apiUrl,params){var url=apiUrl;if(params)for(var key in params){var re=new RegExp(":"+key,"g");url=url.replace(re,params[key])}return CONFIG.ENV.apiPrefix+url}function setPageParameters(params){CONFIG.url&&(params.url=encodeURIComponent(CONFIG.url)),CONFIG.referrer&&(params.referer=encodeURIComponent(CONFIG.referrer)),CONFIG.pageTitle&&(params.pageTitle=encodeURIComponent(CONFIG.pageTitle))}function setClientParameters(params){CONFIG.clientName&&(params.clientName=encodeURIComponent(CONFIG.clientName)),CONFIG.uniqueId&&(params.uniqueId=CONFIG.uniqueId),CONFIG.clientId&&(params.clientId=CONFIG.clientId)}function setBrowserParameters(params){params.cookiesEnabled="false"!==CONFIG.cookiesEnabled}function setGTMDataLayer(time,clientId,uniqueId,companyId){dataLayer.push({clientId:clientId,companyId:companyId,uniqueId:uniqueId,initTime:(new Date).getTime()-time,cookiesEnabledIframe:navigator.cookieEnabled,cookiesEnabledHostedSite:CONFIG.cookiesEnabled,isNew:!!CONFIG.uniqueId,event:"widgetInitialized"})}function setReqTime(){lastReqTime=Date.now()}function tryContinueUpdates(shouldWait){$timeout.cancel(continueUpdatesPromise);var delay,timeSinceLastReq=Date.now()-lastReqTime;delay=shouldWait?CONFIG.pollErrorDelay:timeSinceLastReq>CONFIG.minPollDelay?0:CONFIG.minPollDelay-timeSinceLastReq,continueUpdatesPromise=$timeout(ApiFactory.continueUpdates,delay)}function setLocalStorageExpiration(){Cache.setExpiration(CACHE_ENTRIES.displayState,300)}function notifyUpdates(data){data.agentDetails&&(data.agentDetails.duringInitialization=!1,Pubsub.emit(API_EVENTS.gotAgentUpdates,data.agentDetails)),Pubsub.emit(API_EVENTS.onlineStatus,null===data.isExistOnlineAgent?data.msgs:data.isExistOnlineAgent),data.msgs&&data.msgs.forEach(function(msg){"undefined"!=typeof msg.engagementId&&(msg.data=setEngagementVariables(msg),ApiFactory.updateEngagementMessage(msg.data,msg.id)),"TEXT"===msg.messageType&&Pubsub.emit(API_EVENTS.gotChatUpdates,msg),"ACTION"===msg.messageType&&("undefined"!=typeof msg.engagementId&&Pubsub.emit(API_EVENTS.openInvitation,msg),msg.data===AGENT_ACTIONS.openContactUsForm&&Pubsub.emit(API_EVENTS.gotChatUpdates,msg),msg.data===AGENT_ACTIONS.startVideo&&Pubsub.emit(API_EVENTS.startVideoChat,msg),msg.data===AGENT_ACTIONS.openChat&&Pubsub.emit(API_EVENTS.openChat,msg),msg.data===AGENT_ACTIONS.agentTyping&&Pubsub.emit(API_EVENTS.agentIsTyping),-1!==msg.data.indexOf("CLIENT_REDIRECT::")&&clientRedirect(msg),msg.data===AGENT_ACTIONS.blockClient&&Pubsub.emit(API_EVENTS.blockClient,msg))})}function setEngagementVariables(msg){var msgData=msg.data,newData=msgData.split("*AgentName*").join(msg.senderName);"me"!==$rootScope.GLOBALS.clientName&&(newData=newData.split("*ClientName*").join($rootScope.GLOBALS.clientName));var d=new Date,hours24=d.getHours();return hours24>=5&&12>hours24?newData=newData.split("*DayTime*").join($rootScope.dayTimeTranslations["time.MORNING"]):hours24>=12&&18>hours24?newData=newData.split("*DayTime*").join($rootScope.dayTimeTranslations["time.AFTERNOON"]):hours24>=18&&22>hours24?newData=newData.split("*DayTime*").join($rootScope.dayTimeTranslations["time.EVENING"]):(hours24>=22&&24>hours24||hours24>=0&&5>hours24)&&(newData=newData.split("*DayTime*").join($rootScope.dayTimeTranslations["time.NIGHT"])),newData}function clientRedirect(msg){var url=msg.data.substring("CLIENT_REDIRECT::".length);-1===url.indexOf("http")&&(url="//"+url),window.parent.location=url}function sendGTMFeedbackEvent(clientId,uniqueId,companyId,agentId,rank){dataLayer.push({clientId:clientId,companyId:companyId,uniqueId:uniqueId,agentId:agentId,rank:rank,event:"feedbackSubmitted"})}var ApiFactory={};ApiFactory.EVENTS=API_EVENTS;var apiHttp={call:function(method,url,config){if(ERRORS.fatal){ApiFactory.pauseUpdates();var rejection=$q.defer();return rejection.reject(),rejection.promise}return config=config||{},config.isApi=!0,angular.extend(config,{method:method,url:url}),$http(config)},get:function(url,config){return apiHttp.call("get",url,config)},post:function(url,config){return apiHttp.call("post",url,config)},put:function(url,config){return apiHttp.call("put",url,config)},"delete":function(url,config){return apiHttp.call("delete",url,config)}};ApiFactory.clientId=-1,ApiFactory.uniqueId="",ApiFactory.pollingId="",ApiFactory.brandId=-1,ApiFactory.initialize=function(){var url=makeUrl("clients/initialize/"+CONFIG.companyId),initParams={deviceType:$rootScope.GLOBALS.deviceTypeUA};setPageParameters(initParams),setClientParameters(initParams),setBrowserParameters(initParams);var post=apiHttp.post(url,{params:initParams}),start=(new Date).getTime(),noTracking="true"===CONFIG.noTracking;return post.then(function(response){ApiFactory.pollingId=response.data.pollingId,ApiFactory.clientId=response.data.clientId,ApiFactory.uniqueId=response.data.uniqueId,ApiFactory.brandId=response.data.brandId,ApiFactory.clientName=response.data.name,$rootScope.GLOBALS.controlGroup=response.data.controlGroup,noTracking||setGTMDataLayer(start,ApiFactory.clientId,ApiFactory.uniqueId,CONFIG.companyId),setLocalStorageExpiration(),response.data.agent&&(response.data.agent.duringInitialization=!0,Pubsub.emit(API_EVENTS.gotAgentUpdates,response.data.agent)),response.data.allAgents&&Pubsub.emit(API_EVENTS.allOnlineAgentList,response.data)}),post};var lastReqTime,updatesCanceller,isPaused=!1;ApiFactory.startUpdates=function(){updatesCanceller=$q.defer(),window.updatesCanceller=updatesCanceller,isPaused=!1,ApiFactory.continueUpdates()},ApiFactory.pauseUpdates=function(){isPaused=!0},ApiFactory.resumeUpdates=function(){isPaused=!1},ApiFactory.stopUpdates=function(){isPaused=!1,updatesCanceller&&updatesCanceller.resolve()};var continueUpdatesPromise;ApiFactory.continueUpdates=function(){if(!isPaused){setReqTime();var apiCall=ApiFactory.getUpdates();apiCall.then(function(response){notifyUpdates(response.data),setLocalStorageExpiration(),
tryContinueUpdates()},function(response){return 530===response.status?void window.location.reload():void tryContinueUpdates(!0)})}};var tempIndex=0;return ApiFactory.getUpdates=function(){var url=makeUrl("clients/updates"),get=apiHttp.get(url,{timeout:updatesCanceller.promise,params:{companyId:CONFIG.companyId,clientId:ApiFactory.clientId,pollingId:ApiFactory.pollingId,i:tempIndex}});return++tempIndex,get},ApiFactory.getChatHistory=function(){var url=makeUrl("clients/chat"),getChat=apiHttp.get(url,{params:{clientId:ApiFactory.clientId,uniqueId:ApiFactory.uniqueId}});return getChat},ApiFactory.getChatHistoryForUniqueId=function(){var url=makeUrl("clients/chat/unique"),getChat=apiHttp.get(url,{params:{companyId:CONFIG.companyId,uniqueId:ApiFactory.uniqueId,brandId:ApiFactory.brandId,clientId:ApiFactory.clientId}});return getChat},ApiFactory.sendChatMessage=function(type,content,senderName){var url=makeUrl("clients/chat"),post=apiHttp.post(url,{params:{companyId:CONFIG.companyId,clientId:ApiFactory.clientId,uniqueId:ApiFactory.uniqueId},data:{msgType:type,data:content,senderName:senderName}});return post},ApiFactory.updateEngagementMessage=function(data,id){var url=makeUrl("clients/chat/updateEngagementMsg"),post=apiHttp.post(url,{params:{companyId:CONFIG.companyId,clientId:ApiFactory.clientId,uniqueId:ApiFactory.uniqueId},data:{id:id,data:data}});return post},ApiFactory.sendCustomerFeedback=function(id,rank,feedbackText,agentId){var url=makeUrl("clients/feedback"),promise=apiHttp.put(url,{data:{id:id,companyId:CONFIG.companyId,uniqueId:ApiFactory.uniqueId,clientId:ApiFactory.clientId,rank:rank,feedbackText:feedbackText,agentId:agentId}}),noTracking="true"===CONFIG.noTracking;return noTracking||sendGTMFeedbackEvent(ApiFactory.clientId,ApiFactory.uniqueId,CONFIG.companyId,agentId,rank),promise},ApiFactory.getCustomerFeedback=function(agentId){var url=makeUrl("clients/feedback"),promise=apiHttp.get(url,{params:{companyId:CONFIG.companyId,clientId:ApiFactory.clientId,uniqueId:ApiFactory.uniqueId,agentId:agentId}});return promise},ApiFactory.sendClientEvent=function(eventData){var url=makeUrl("clients/postClientEvent"),params={companyId:CONFIG.companyId,clientId:ApiFactory.clientId,uniqueId:ApiFactory.uniqueId};setPageParameters(params);var post=apiHttp.post(url,{params:params,data:eventData});return post},ApiFactory.sendCustomClientId=function(customId){var url=makeUrl("clients/postCustomClientId"),params={companyId:CONFIG.companyId,clientId:ApiFactory.clientId,uniqueId:ApiFactory.uniqueId,customClientId:customId};setPageParameters(params);var post=apiHttp.post(url,{params:params});return post},ApiFactory.sendContactDetails=function(name,email,phone,msg,sendNotification){var url=makeUrl("clients/postDetails"),clientData={};name&&(clientData.name=name,$rootScope.GLOBALS.clientName=name,$rootScope.GLOBALS.clientEmail=email),phone&&(clientData.phone=phone),email&&(clientData.email=email),msg&&(clientData.question=msg);var params={brandId:ApiFactory.brandId,companyId:CONFIG.companyId,clientId:ApiFactory.clientId,uniqueId:ApiFactory.uniqueId,sendNotification:sendNotification};setPageParameters(params);var post=apiHttp.post(url,{params:params,data:clientData});return post},ApiFactory.call=function(phone){var url=makeUrl("clients/phoneCall"),clientData={phone:phone},params={companyId:CONFIG.companyId,clientId:ApiFactory.clientId,uniqueId:ApiFactory.uniqueId},post=apiHttp.post(url,{params:params,data:clientData});return post},ApiFactory.postInitialization=function(geoLocation){var url=makeUrl("clients/postInitialization"),clientData={type:"TRAFFIC",location:geoLocation},params={companyId:CONFIG.companyId,clientId:ApiFactory.clientId},post=apiHttp.post(url,{params:params,data:clientData});return post},ApiFactory.getVideoToken=function(agentId){var url=makeUrl("clients/startCamera",{agentId:agentId});return apiHttp.get(url,{params:{companyId:CONFIG.companyId,clientId:ApiFactory.clientId}})},ApiFactory.sendMessageToHostingSite=function(action){var toWidgetEvent=$rootScope.Message.toWidget.onClientAction;if(toWidgetEvent.events[action]){var actionDesc={clientId:ApiFactory.clientId,description:toWidgetEvent.events[action]};$rootScope.Message.send(toWidgetEvent.name,actionDesc,function(){})}},ApiFactory}]),angular.module("proonto.api").provider("ApiFactory",function(){this.$get=["RealApiFactory","MockApiFactory","CONFIG",function(RealApi,MockApi,CONFIG){return"true"===CONFIG.demo?MockApi:RealApi}]}).factory("MockApiFactory",["$http","$timeout","$q","PubsubFactory","API_EVENTS","AGENT_ACTIONS","CONFIG","CacheFactory","CACHE_ENTRIES","ERRORS","RealApiFactory",function($http,$timeout,$q,Pubsub,API_EVENTS,AGENT_ACTIONS,CONFIG,Cache,CACHE_ENTRIES,ERRORS,RealApi){function makeUrl(apiUrl,params){var url=apiUrl;if(params)for(var key in params){var re=new RegExp(":"+key,"g");url=url.replace(re,params[key])}return CONFIG.ENV.apiPrefix+url}function tryContinueUpdates(){$timeout(ApiFactory.continueUpdates,1e3)}function notifyUpdates(data){data.msgs&&data.msgs.forEach(function(msg){"TEXT"===msg.messageType&&Pubsub.emit(API_EVENTS.gotChatUpdates,msg),"ACTION"===msg.messageType&&(msg.data===AGENT_ACTIONS.openInvitation&&Pubsub.emit(API_EVENTS.openInvitation,msg),msg.data===AGENT_ACTIONS.openContactUsForm&&Pubsub.emit(API_EVENTS.gotChatUpdates,msg),msg.data===AGENT_ACTIONS.startVideo&&Pubsub.emit(API_EVENTS.startVideoChat,msg),msg.data===AGENT_ACTIONS.openChat&&Pubsub.emit(API_EVENTS.openChat,msg),msg.data===AGENT_ACTIONS.agentTyping&&Pubsub.emit(API_EVENTS.showInMessageCenter,"Agent is typing..."))}),data.agentDetails&&Pubsub.emit(API_EVENTS.gotAgentUpdates,data.agentDetails)}function getEmptyResponse(){var deferred=$q.defer(),promise=deferred.promise;return deferred.resolve({data:{}}),promise}var ApiFactory={},mockMessages=[];mockMessages.push({data:"Hello and welcome to our live chat!",messageType:"TEXT",senderType:"AGENT",senderName:"Agent",state:"DONE"}),mockMessages.push({data:"Can I help you?",messageType:"TEXT",senderType:"AGENT",senderName:"Agent",state:"DONE"}),mockMessages.push({data:"I just wanted to say that your chat is pretty cool",messageType:"TEXT",senderType:"CLIENT",state:"DONE"}),mockMessages.push({data:"How can I have it on my website?",messageType:"TEXT",senderType:"CLIENT",state:"DONE"}),mockMessages.push({data:"Just fill in your details, and we will contact you",messageType:"TEXT",senderType:"AGENT",senderName:"Agent",state:"DONE"}),mockMessages.push({data:"OPEN_CONTACT_US_FORM",messageType:"ACTION",senderType:"AGENT",state:"DONE"}),ApiFactory.EVENTS=API_EVENTS;var apiHttp={call:function(method,url,config){if(ERRORS.fatal){ApiFactory.pauseUpdates();var rejection=$q.defer();return rejection.reject(),rejection.promise}return config=config||{},config.isApi=!0,angular.extend(config,{method:method,url:url}),$http(config)},get:function(url,config){return apiHttp.call("get",url,config)},post:function(url,config){return apiHttp.call("post",url,config)},put:function(url,config){return apiHttp.call("put",url,config)},"delete":function(url,config){return apiHttp.call("delete",url,config)}};ApiFactory.clientId=-1,ApiFactory.uniqueId="",ApiFactory.pollingId="",ApiFactory.brandId=-1,ApiFactory.initialize=function(){var url=makeUrl("clients/initialize/demo/"+CONFIG.companyId),post=apiHttp.post(url,{params:{url:CONFIG.url}});return post.then(function(response){ApiFactory.pollingId="pollingId-def",ApiFactory.clientId=123,ApiFactory.uniqueId="uniqueId-abc",$timeout(function(){response.data.agent={agentName:"Agent",agentId:123,profilePicture:"ba609b00ecd511e4b91781482f851217"},Pubsub.emit(API_EVENTS.gotAgentUpdates,response.data.agent)},4e3)}),post},ApiFactory.postInitialization=function(){return getEmptyResponse()},ApiFactory.startUpdates=function(){$timeout(function(){ApiFactory.continueUpdates()},7700),Cache.setExpiration(CACHE_ENTRIES.displayState,1)},ApiFactory.pauseUpdates=function(){},ApiFactory.resumeUpdates=function(){},ApiFactory.stopUpdates=function(){};var msgIndex=0;return ApiFactory.continueUpdates=function(){$timeout(function(){if(mockMessages.length>msgIndex){var data={};data.msgs=[],data.msgs.push(mockMessages[msgIndex]),++msgIndex,notifyUpdates(data)}tryContinueUpdates({})},2e3)},ApiFactory.getUpdates=function(){return getEmptyResponse()},ApiFactory.getChatHistory=function(){return getEmptyResponse()},ApiFactory.getChatHistoryForUniqueId=function(){return getEmptyResponse()},ApiFactory.sendChatMessage=function(type,content){return getEmptyResponse()},ApiFactory.sendContactDetails=function(name,email,phone){return getEmptyResponse()},ApiFactory.getVideoToken=function(agentId){return getEmptyResponse()},ApiFactory.sendMessageToHostingSite=function(action){},ApiFactory}]),angular.module("proonto.agent",[]),angular.module("proonto.agent").factory("AgentFactory",["ApiFactory","PubsubFactory","$rootScope","CONFIG",function(Api,Pubsub,$rootScope,CONFIG){var AgentFactory={};return AgentFactory.agent={},AgentFactory.allOnlineAgents={},Pubsub.on(Api.EVENTS.allOnlineAgentList,null,function(event,data){for(var threeAgentsList=[],i=0;i<data.onlineAgents.length;i++){for(var agentId=data.onlineAgents[i],j=0;j<data.allAgents.length;j++)if(data.allAgents[j].agentId===agentId&&"undefined"!=typeof data.allAgents[j].profilePicture){threeAgentsList.push(data.allAgents[j]);break}if(3===threeAgentsList.length)break}if(threeAgentsList.length<3)for(i=0;i<data.allAgents.length;i++){for(var inList=!1,agentId2=data.allAgents[i].agentId,k=0;k<data.onlineAgents.length&&(data.onlineAgents[k]===agentId2&&(inList=!0),!inList);k++);if(inList||"undefined"==typeof data.allAgents[i].profilePicture||threeAgentsList.push(data.allAgents[i]),3===threeAgentsList.length)break}AgentFactory.allOnlineAgents=threeAgentsList}),Pubsub.on(Api.EVENTS.gotAgentUpdates,null,function(event,agentDetails){agentDetails.agentId<0?(angular.copy({},AgentFactory.agent),Pubsub.emit(Api.EVENTS.agentChange,!1)):(angular.extend(AgentFactory.agent,agentDetails),agentDetails.profilePicture=AgentFactory.getAgentPhotoUrl("lg"),$rootScope.Message.send($rootScope.Message.toWidget.onAgentApproach,agentDetails,function(){}),Pubsub.emit(Api.EVENTS.agentChange,!0))}),AgentFactory.getAgentPhotoUrl=function(size){if(!AgentFactory.agent||!AgentFactory.agent.profilePicture)return"assets/avatar.png";var fileName=AgentFactory.agent.profilePicture;return-1===fileName.toLowerCase().indexOf(".gif")&&(fileName+=".jpg"),CONFIG.ENV.agentPics+(size||"md")+"/"+fileName},AgentFactory}]),angular.module("proonto.cache",["LocalStorageModule"]),angular.module("proonto.cache").constant("CACHE_ENTRIES",{displayState:"display_state",unreadMsg:"unread_messages",feedbackMsg:"feedback_msg"}),angular.module("proonto.cache").service("CacheFactory",["localStorageService",function(localStorageService){return{set:function(key,value,expireTimeInSeconds){localStorageService.set(key,{data:value,timestamp:(new Date).getTime(),expireTimeInMilliseconds:1e3*expireTimeInSeconds})},setExpiration:function(key,expireTimeInSeconds){this.get(key);var item=localStorageService.get(key);null!==item&&localStorageService.set(key,{data:item.data,timestamp:(new Date).getTime(),expireTimeInMilliseconds:1e3*expireTimeInSeconds})},get:function(key){var item=localStorageService.get(key);return null===item?null:!item||(new Date).getTime()>item.timestamp+item.expireTimeInMilliseconds?(localStorageService.remove(key),null):item.data}}}]),angular.module("proonto.user",[]).factory("User",function(){}),angular.module("proonto.chat",[]),angular.module("proonto.chat").constant("CLIENT_ACTIONS",{typing:"TYPING",stopTyping:"STOP_TYPING",quit:"QUIT",updateName:"UPDATE_NAME",clickMic:"CLICK_MIC",clickCam:"CLICK_CAM",clickCall:"CLICK_CALL",clickChat:"CLICK_CHAT",clickContact:"CLICK_CONTACT",chatAlreadyOpen:"CHAT_ALREADY_OPEN",requestVideo:"REQUEST_VIDEO",requestAudio:"REQUEST_AUDIO",closeInvitation:"CLOSE_INVITATION",closeVideo:"CLOSE_VIDEO",closeChat:"CLOSE_CHAT",calling:"CALLING",chatOpened:"CHAT_OPENED",chatInvite:"CHAT_INVITE",chatInviteDisabledOnMobile:"CHAT_INVITE_DISABLED_ON_MOBILE",acceptInvitation:"ACCEPT_INVITATION",videoInvite:"VIDEO_INVITE",videoEnd:"VIDEO_END",inChatContactUsReceived:"IN_CHAT_CONTACT_US_RECEIVED",chatVideoDeviceNotSupported:"CHAT_VIDEO_DEVICE_NOT_SUPPORTED",clientBrowserNotSupported:"CLIENT_BROWSER_NOT_SUPPORTED",contactDetailsEntered:"CONTACT_DETAILS_ENTERED"}).factory("ChatFactory",["$rootScope","ApiFactory","PubsubFactory","AGENT_ACTIONS","CLIENT_ACTIONS","CONFIG","AgentFactory",function($rootScope,Api,Pubsub,AGENT_ACTIONS,CLIENT_ACTIONS,CONFIG,AgentFactory){function mergeUpdates(message){pushNewChatMessage(new ChatMessage(message))}function pushNewChatMessage(chatMessage){ChatFactory.messages.push(chatMessage),"TEXT"===chatMessage.type&&("CLIENT"===chatMessage.senderType?ChatFactory.clientMessagesCount++:"AGENT"===chatMessage.senderType&&ChatFactory.agentMessagesCount++)}var ChatFactory={};ChatFactory.messages=[],Pubsub.on(Api.EVENTS.gotChatUpdates,null,function(event,message){mergeUpdates(message),"ACTION"!==message.type&&message.data===AGENT_ACTIONS.openContactUsForm&&ChatFactory.sendAction(CLIENT_ACTIONS.inChatContactUsReceived)});var ChatMessage=function(message){this.content=message.data,this.type=message.messageType,this.senderName=message.senderName,this.senderType=message.senderType,this.agentId=message.agentId,this.state=message.state||"DONE"};return ChatFactory.call=function(phone){Api.call(phone),Api.sendMessageToHostingSite(CLIENT_ACTIONS.clickCall)},ChatFactory.sendSystemMessage=function(text){var newChatMessage=new ChatMessage({data:text,messageType:"TEXT",senderType:"SYSTEM",state:"DONE",senderName:"Info"});pushNewChatMessage(newChatMessage)},ChatFactory.sendText=function(text,senderName){var apiCall=Api.sendChatMessage("TEXT",text,senderName),newChatMessage=new ChatMessage({data:text,messageType:"TEXT",senderType:"CLIENT",state:"SENDING",senderName:senderName}),params=[Api.clientId,text];return $rootScope.Message.send($rootScope.Message.toWidget.onChatMessage,params,function(){}),pushNewChatMessage(newChatMessage),apiCall.then(function(){newChatMessage.state="DONE"}),apiCall},ChatFactory.customerFeedback={feedbackData:{id:null,rank:null,feedbackText:null},sendFeedback:function(rank,feedbackText){var feedback=ChatFactory.customerFeedback.feedbackData,apiCall=Api.sendCustomerFeedback(feedback.id,rank,feedbackText,AgentFactory.agent.agentId);apiCall.then(function(response){ChatFactory.customerFeedback.feedbackData=response.data});var feedbackObj={rank:rank,text:feedbackText};return $rootScope.Message.send($rootScope.Message.toWidget.onClientFeedback,feedbackObj,function(){}),apiCall},getFeedback:function(){var apiCall=Api.getCustomerFeedback(AgentFactory.agent.agentId);return apiCall.then(function(response){ChatFactory.customerFeedback.feedbackData=response.data}),apiCall}},ChatFactory.getChatHistory=function(){var apiCall=Api.getChatHistoryForUniqueId();return apiCall.then(function(respone){ChatFactory.messages.splice(0,ChatFactory.messages.length),angular.forEach(respone.data,function(msg){pushNewChatMessage(new ChatMessage(msg))})}),apiCall},ChatFactory.sendAction=function(action){var apiCall=Api.sendChatMessage("ACTION",action);return Api.sendMessageToHostingSite(action),apiCall},ChatFactory.sendClientName=function(name){Api.sendContactDetails(name,"","",void 0,!1),Api.sendMessageToHostingSite(CLIENT_ACTIONS.updateName)},ChatFactory.agentMessagesCount=0,ChatFactory.clientMessagesCount=0,ChatFactory}]),angular.module("proonto.video",[]),angular.module("proonto.video").constant("VIDEO_EVENTS",{agentStreamStart:"events.video.agentStreamStart",agentStreamStop:"events.video.agentStreamStop",clientStreamStart:"events.video.clientStreamStart",clientStreamStop:"events.video.clientStreamStop",errorInitSession:"events.video.errorInitSession",agentStreamCancelled:"events.video.agentStreamCancelled"}).factory("VideoFactory",["$rootScope","ApiFactory","PubsubFactory","VIDEO_EVENTS","$timeout","CONFIG",function($rootScope,Api,Pubsub,VIDEO_EVENTS,$timeout,CONFIG){function exceptionHandler(event){}function sessionConnectedHandler(event){}function sessionDisconnectedHandler(event){$rootScope.$apply(function(){VideoFactory.closeVideo()})}function publisherCreatedHandler(e){VideoFactory.session.publish(VideoFactory.publisher)}function streamCreatedHandler(event){$rootScope.$apply(function(){var subscriberProperties={insertMode:"append",width:150,height:140,style:{nameDisplayMode:"off"}};VideoFactory.subscriber=VideoFactory.session.subscribe(event.stream,"agent-stream",subscriberProperties)})}function getExpectedProtocol(){return"dev"===window.ENV.name?"http://":"https://"}function streamDestroyedHandler(event){}function connectionDestroyedHandler(){$rootScope.$apply(function(){VideoFactory.closeVideo()})}function connectionCreatedHandler(event){event.connection.connectionId!==VideoFactory.session.connection.connectionId&&(VideoFactory.micActive||VideoFactory.cameraActive)&&VideoFactory.startClientStream()}var VideoFactory={};VideoFactory.EVENTS=VIDEO_EVENTS,OT.setLogLevel(OT.DEBUG),VideoFactory.session=null,VideoFactory.publisher=null,VideoFactory.subscriber=null,VideoFactory.cameraActive=void 0,VideoFactory.micActive=void 0;var credentials={apiKey:"",sessionId:"",token:""};return Pubsub.on(Api.EVENTS.startVideoChat,null,function(event,msgDetails){if(OT&&OT.checkSystemRequirements()){var apiCall=Api.getVideoToken(msgDetails.agentId);apiCall.then(function(response){credentials.apiKey=response.data.apiKey,credentials.sessionId=response.data.sessionId,credentials.token=response.data.token,VideoFactory.init()})}}),VideoFactory.closeVideo=function(){VideoFactory.stopClientStream(),VideoFactory.session&&(VideoFactory.session.unsubscribe(VideoFactory.subscriber),VideoFactory.subscriber=null,VideoFactory.sessionDisconnect()),VideoFactory.cameraActive=void 0,VideoFactory.micActive=void 0,Pubsub.emit(Api.EVENTS.endVideoChat,{})},VideoFactory.startClientStream=function(){VideoFactory.publisher=OT.initPublisher("publisher-stream",{style:{buttonDisplayMode:"off",nameDisplayMode:"off"},width:150,height:140,encodedWidth:320,encodedHeight:240,insertMode:"append"},publisherCreatedHandler),VideoFactory.publisher.on("accessDenied",function(){}),VideoFactory.publisher.on("accessAllowed",function(){}),VideoFactory.publisher.on("accessDialogOpened",function(){}),VideoFactory.publisher.on("accessDialogClosed",function(){}),VideoFactory.publisher.on("streamCreated",function(event){}),VideoFactory.publisher.on("streamDestroyed",function(event){event.preventDefault()}),VideoFactory.setMicActive(VideoFactory.micActive),VideoFactory.setCameraActive(VideoFactory.cameraActive)},VideoFactory.setCameraActive=function(on){VideoFactory.cameraActive=on,VideoFactory.publisher.publishVideo(on)},VideoFactory.setMicActive=function(on){VideoFactory.micActive=on,VideoFactory.publisher.publishAudio(on)},VideoFactory.stopClientStream=function(){VideoFactory.publisher&&(VideoFactory.session.unpublish(VideoFactory.publisher),VideoFactory.publisher.destroy())},VideoFactory.videoPossible=function(){var isVideoSupported=OT&&OT.checkSystemRequirements(),isVideoEnabled=isVideoSupported&&!$rootScope.DISPLAY.disableVideo;return isVideoEnabled&&CONFIG.url.indexOf(getExpectedProtocol())>-1},VideoFactory.init=function(){VideoFactory.sessionDisconnect(),VideoFactory.session=OT.initSession(credentials.apiKey,credentials.sessionId),VideoFactory.session.on("sessionConnected",sessionConnectedHandler),VideoFactory.session.on("sessionDisconnected",sessionDisconnectedHandler),VideoFactory.session.on("connectionCreated",connectionCreatedHandler),VideoFactory.session.on("connectionDestroyed",connectionDestroyedHandler),VideoFactory.session.on("streamCreated",streamCreatedHandler),VideoFactory.session.on("streamDestroyed",streamDestroyedHandler),VideoFactory.session.connect(credentials.token)},VideoFactory.sessionDisconnect=function(){VideoFactory.session&&(VideoFactory.session.off("sessionConnected",sessionConnectedHandler),VideoFactory.session.off("sessionDisconnected",sessionDisconnectedHandler),VideoFactory.session.off("connectionCreated",connectionCreatedHandler),VideoFactory.session.off("connectionDestroyed",connectionDestroyedHandler),VideoFactory.session.off("streamCreated",streamCreatedHandler),VideoFactory.session.off("streamDestroyed",streamDestroyedHandler),VideoFactory.publisher&&(VideoFactory.session.unpublish(VideoFactory.publisher),VideoFactory.publisher.destroy(),VideoFactory.publisher=null),VideoFactory.session.disconnect(),VideoFactory.session=null)},OT.on("exception",exceptionHandler),VideoFactory}]),angular.module("proonto.utils",[]).factory("UtilsFactory",["$rootScope",function($rootScope){var UtilsFactory={};return UtilsFactory.getAgentName=function(agent){return agent?"en"!==$rootScope.DISPLAY.language&&agent.foreignName?agent.foreignName:agent.agentName:""},UtilsFactory}]),angular.module("proonto.ui",["proonto.api","material.components.tooltip"]),angular.module("proonto.ui").directive("stateMachine",["$rootScope","$timeout",function($rootScope,$timeout){return{restrict:"A",scope:!0,templateUrl:"directives/state-machine.tpl.html",link:function($scope,$element,$attr){$scope.display=$rootScope.GLOBALS.displayState,$scope.$watch("GLOBALS.displayState",function(newVal,oldVal){$scope.display=$rootScope.GLOBALS.displayState}),$scope.isPacmanEnabled=function(displayState){return null===displayState?!1:displayState===$scope.DisplayForm.none?!1:displayState===$scope.DisplayForm.onlineChat?!1:displayState===$scope.DisplayForm.chatInvitation?!1:"classic"===$rootScope.DISPLAY.shape||displayState===$scope.DisplayForm.contactDetails}}}}]),angular.module("proonto.ui").directive("chatContactForm",["$rootScope","$timeout","$translate",function($rootScope,$timeout,$translate){return{restrict:"A",scope:!0,templateUrl:"directives/chat/chat-contact-form.tpl.html",link:function($scope,$element,$attr){function updateCSS(){$scope.inlineStyle.width=$rootScope.percToPx(83,"width"),$scope.contactFormStyle.width=$rootScope.percToPx(75,"width")}$scope.requestStatusEnum={NOT_STARTED:0,FAILURE:1,SUCCESS:2},$scope.requestStatus=$scope.requestStatusEnum.NOT_STARTED,$scope.btnStyle={};var translations=["placeholders.NAME","placeholders.PHONE","placeholders.EMAIL","placeholders.SEND"];$scope.placeholders={},$translate(translations).then(function(returnedVal){$scope.placeholders.name=returnedVal["placeholders.NAME"],$scope.placeholders.phone=returnedVal["placeholders.PHONE"],$scope.placeholders.email=returnedVal["placeholders.EMAIL"],$scope.placeholders.send=returnedVal["placeholders.SEND"]}),$scope.inlineStyle={background:$rootScope.DISPLAY.mainColor},$scope.contactFormStyle={},$rootScope.GLOBALS.isMobileUA&&!$rootScope.GLOBALS.isTabletUA&&updateCSS(),$rootScope.$on("updateViewport",function(){$scope.$apply(function(){updateCSS()})}),$scope.clientDetails={name:null,email:null,phone:null},$scope.keyUp=function($event){$scope.validateForm()?$scope.btnStyle={background:"white",color:"black","font-weight":"bold","border-color":"white"}:$scope.btnStyle={},13===$event.keyCode&&$scope.submit()},$scope.submit=function(){$scope.validateForm()&&$scope.innerSetClientDetails($scope.clientDetails,!0).then(function(response){$scope.requestStatus=$scope.requestStatusEnum.SUCCESS,$rootScope.GLOBALS.clientName=$scope.clientDetails.name})["catch"](function(){$scope.requestStatus=$scope.requestStatusEnum.FAILURE})},$scope.validateForm=function(){return $scope.validateEmailFormat($scope.clientDetails.email)&&$scope.clientDetails.name&&$scope.clientDetails.name.length>0}}}}]),angular.module("proonto.ui").directive("chat",["$rootScope","$timeout","ChatFactory","PubsubFactory","ApiFactory","AgentFactory",function($rootScope,$timeout,Chat,Pubsub,Api,Agent){return{restrict:"A",scope:!0,templateUrl:"directives/chat/chat.tpl.html",link:function($scope,$element,$attr){function updateCSS(){$scope.chatTopStyle.height=$rootScope.percToPx(18,"height"),$scope.chatList.height=$rootScope.percToPx(50,"height"),$scope.chatBottom.height=$rootScope.percToPx(10,"height")}function updateStyles(){$scope.viewModeStyle.height=$rootScope.percToPx(100,"height")}function isDesktop(){return $rootScope.GLOBALS.isDesktopUA}function bindEvents(){if(isDesktop()){var target=$element[0].querySelector("#close-chat-form");target=$element[0].querySelector("#close-chat-form-button"),$rootScope.bindEvent("mouseenter",target,$scope.showCloseButtonMsg)}}function doResize(){$timeout(function(){var agentImageHeight=55,height=$element[0].firstChild.clientHeight;$scope.resizeIframe(height+agentImageHeight)})}$scope.msgs=Chat.messages,$scope.viewMode=$rootScope.DISPLAY.viewMode,$scope.viewModeStyle={},$scope.closeBtnStyle=void 0===Agent.agent.agentId?{color:"white"}:{color:$rootScope.DISPLAY.mainColor},$scope.closeBtnMsg="Close chat",$scope.chatTopStyle={},$scope.chatList={},$scope.chatBottom={},$scope.showVideoPanel=$rootScope.GLOBALS.showVideoPanel,$rootScope.GLOBALS.isMobileUA&&!$rootScope.GLOBALS.isTabletUA&&updateCSS(),$rootScope.$on("updateViewport",function(){$scope.$apply(function(){updateCSS(),updateStyles()})}),$scope.showCloseButtonMsg=function(){$rootScope.GLOBALS.showVideoPanel?$scope.closeBtnMsg="Close video chat":$scope.customerFeedback.isOpened?$scope.closeBtnMsg="Close feedback from":$scope.closeBtnMsg="Close chat",$scope.showInMessageCenter($scope.closeBtnMsg)},bindEvents(),"NORMAL"===$scope.viewMode&&($scope.viewModeStyle={border:"none",background:"transparent"}),$rootScope.GLOBALS.isMobileUA&&updateStyles(),Pubsub.on(Api.EVENTS.gotAgentUpdates,null,function(event,isAgent){$scope.isAgent=isAgent,isAgent.agentId<0?$scope.closeBtnStyle={color:"white"}:$scope.closeBtnStyle={color:$rootScope.DISPLAY.mainColor}}),$rootScope.$watch("GLOBALS.showPhonePanel",doResize),$rootScope.$watch("GLOBALS.showVideoPanel",doResize),$scope.$watch("msgs.length",doResize),$timeout(doResize,700)}}}]),angular.module("proonto.ui").directive("mobileChat",["$rootScope","$timeout","ChatFactory",function($rootScope,$timeout,Chat){return{restrict:"A",scope:!0,templateUrl:"directives/chat/mobile-chat.tpl.html",link:function($scope,$element,$attr){$scope.circleColor={"background-color":$rootScope.DISPLAY.mainColor};var keyboardOpenTopIos={height:$rootScope.GLOBALS.isKeyboardOpen?"50%":"",top:$rootScope.GLOBALS.isKeyboardOpen?"":"120px"},keyboardOpenTopAndroid={height:($rootScope.GLOBALS.isKeyboardOpen,"100%"),bottom:$rootScope.GLOBALS.isKeyboardOpen?"10%":"55px",top:$rootScope.GLOBALS.isKeyboardOpen?"":"120px"};$scope.keyboardOpenTop=$rootScope.GLOBALS.isiOs?keyboardOpenTopIos:keyboardOpenTopAndroid,$rootScope.$watch("GLOBALS.isKeyboardOpen",function(){var keyboardOpenTopIos={height:$rootScope.GLOBALS.isKeyboardOpen?"50%":"",top:$rootScope.GLOBALS.isKeyboardOpen?"":"120px"},keyboardOpenTopAndroid={height:($rootScope.GLOBALS.isKeyboardOpen,"100%"),bottom:$rootScope.GLOBALS.isKeyboardOpen?"10%":"55px",top:$rootScope.GLOBALS.isKeyboardOpen?"":"120px"};$scope.keyboardOpenTop=$rootScope.GLOBALS.isiOs?keyboardOpenTopIos:keyboardOpenTopAndroid}),$scope.mainColor=$rootScope.DISPLAY.mainColor,$scope.secondaryColor=$rootScope.DISPLAY.secondaryColor,$scope.userMessageColor={backgroundColor:$scope.mainColor}}}}]),angular.module("proonto.ui").directive("chatTop",["$rootScope","AgentFactory","ChatFactory","CLIENT_ACTIONS","VideoFactory","$timeout","$parse","UtilsFactory","CONFIG","CacheFactory","CACHE_ENTRIES","ApiFactory","$translate","PubsubFactory",function($rootScope,Agents,Chat,CLIENT_ACTIONS,Video,$timeout,$parse,Utils,CONFIG,CacheFactory,CACHE_ENTRIES,Api,$translate,Pubsub){return{restrict:"A",scope:!0,templateUrl:"directives/chat/chat-top.tpl.html",link:function($scope,$element,$attr){$scope.isDisableVideo=$rootScope.DISPLAY.disableVideo,$scope.agent=Agents.agent,$scope.GLOBALS=$rootScope.GLOBALS,$scope.sentFeedback=!1,$scope.agentProfilePhoto=Agents.getAgentPhotoUrl(),$scope.classicView="CLASSIC"===$rootScope.DISPLAY.viewMode,$scope.showPhoneButton=$rootScope.DISPLAY.telephone&&$rootScope.DISPLAY.telephone.length>4&&$rootScope.DISPLAY.showPhoneBtn,$scope.circleColor={background:$rootScope.DISPLAY.mainColor},$scope.phoneHoverMsg="Ask for a phone call",$scope.phoneNumber=$rootScope.phoneNumber,$scope.isMobile=$rootScope.GLOBALS.isMobileUA,$scope.onlineAgentsList=Agents.allOnlineAgents,$scope.allAgentsPanelWidth=$scope.onlineAgentsList.length<3?$scope.onlineAgentsList.length<2?{width:"20%"}:{width:"40%"}:{width:"60%"},$scope.getAgentName=function(agent){return Utils.getAgentName(agent)};var feedback={init:function(){angular.extend($scope.feedback,Chat.customerFeedback.feedbackData),$scope.$watch(function(){return Chat.customerFeedback.feedbackData},function(newVal,oldVal){newVal!==oldVal&&angular.extend($scope.feedback,Chat.customerFeedback.feedbackData)})}};$scope.getAgentPhotoUrl=function(url,size){var fileName=url;return-1===fileName.toLowerCase().indexOf(".gif")&&(fileName+=".jpg"),CONFIG.ENV.agentPics+(size||"md")+"/"+fileName},$scope.feedback={rankPressed:!1,isSendBtnDisabled:!1,rank:0,feedbackText:"",hover:0,sendFeedback:function(isFromBtn){Chat.customerFeedback.sendFeedback($scope.feedback.rank,$scope.feedback.feedbackText).then(function(){isFromBtn&&($scope.sentFeedback=!0,$scope.feedback.isSendBtnDisabled=!0,$timeout(function(){$scope.feedback.rankPressed=!1},2e3))})},showFeedback:function(){var parentFeedback=$scope.customerFeedback,isShowFeedback=Agents.agent&&Agents.agent.agentId&&Chat.clientMessagesCount>1&&Chat.agentMessagesCount>1&&Chat.clientMessagesCount+Chat.agentMessagesCount>6;if(isShowFeedback){if("true"!==CacheFactory.get(CACHE_ENTRIES.feedbackMsg+"_"+Api.clientId)){CacheFactory.set(CACHE_ENTRIES.feedbackMsg+"_"+Api.clientId,"true",3600);var translations=["feedback.FEEDBACK_MSG"];$translate(translations).then(function(returnedVal){Chat.sendSystemMessage(returnedVal["feedback.FEEDBACK_MSG"])})}parentFeedback.isOpened=!0}return isShowFeedback},starClass:function(starIdx){var classList="",rank=$scope.feedback.rank,hover=$scope.feedback.hover;return 0===starIdx&&(rank>0?classList="active":hover>0&&rank?classList="active":hover>0&&!rank&&(classList="hover")),1===starIdx&&(rank&&hover>1?classList="active":!hover&&rank>1?classList="active":hover>1&&rank?classList="active":hover>1&&!rank&&(classList="hover")),2===starIdx&&(rank&&hover>2?classList="active":!hover&&rank>2?classList="active":hover>2&&rank?classList="active":hover>2&&!rank&&(classList="hover")),3===starIdx&&(rank&&hover>3?classList="active":!hover&&rank>3?classList="active":hover>3&&rank?classList="active":hover>3&&!rank&&(classList="hover")),4===starIdx&&(rank&&hover>4?classList="active":!hover&&rank>4?classList="active":hover>4&&rank?classList="active":hover>4&&!rank&&(classList="hover")),classList},setRank:function(rank){$scope.feedback.rankPressed=!0,$scope.sentFeedback=!1,$scope.feedback.isSendBtnDisabled=!1,$scope.feedback.rank=rank,$scope.feedback.sendFeedback()},setStarHover:function(position){$scope.feedback.hover=position}},$scope.isRTL=function(str){var regex=/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/,rtlLetters=str.match(regex);return rtlLetters?{"margin-right":"-3px"}:!1},feedback.init(),$scope.agent.agentName?($scope.borderedContainerStyle={"background-color":"white",border:"1px solid white",height:"70px"},$scope.companyColor={color:$rootScope.DISPLAY.mainColor}):($scope.borderedContainerStyle={"background-color":$rootScope.DISPLAY.mainColor,border:"1px solid white",height:"100px"},$scope.companyColor={color:"white"}),Pubsub.on(Api.EVENTS.gotAgentUpdates,null,function(event,isAgent){$scope.isAgent=isAgent,isAgent.agentId<0?($scope.borderedContainerStyle={"background-color":$rootScope.DISPLAY.mainColor,border:"1px solid white",height:"100px"},$scope.companyColor={color:"white"}):($scope.borderedContainerStyle={"background-color":"white",border:"1px solid white",height:"70px"},$scope.companyColor={color:$rootScope.DISPLAY.mainColor})}),$scope.$watch("agent.profilePicture",function(){
$scope.agentProfilePhoto=Agents.getAgentPhotoUrl()}),$scope.showPhoneHoverMsg=function(){$scope.phoneHoverMsg=$scope.phoneHoverMsg=$rootScope.GLOBALS.showPhonePanel?"Close phone panel":"Ask for a phone call",$scope.showInMessageCenter($scope.phoneHoverMsg)},$scope.buttonsStyle={border:"1px solid white","margin-left":"0px"},$scope.photoBorderColor={"border-color":$rootScope.DISPLAY.mainColor},$scope.toggleOnVideoChat=function(){$scope.openVideoChat(!$rootScope.GLOBALS.showVideoPanel)},$scope.toggleOnAudioChat=function(){$scope.openAudioChat(!$rootScope.GLOBALS.showVideoPanel)},$scope.toggleOnPhoneCall=function(){$scope.openPhoneCall(!$rootScope.GLOBALS.showPhonePanel)}}}}]),angular.module("proonto.ui").directive("mobileChatTop",["$rootScope","AgentFactory","ChatFactory","CLIENT_ACTIONS","VideoFactory","$timeout","$parse","UtilsFactory","CONFIG","CacheFactory","CACHE_ENTRIES","ApiFactory","$translate",function($rootScope,Agents,Chat,CLIENT_ACTIONS,Video,$timeout,$parse,Utils,CONFIG,CacheFactory,CACHE_ENTRIES,Api,$translate){return{restrict:"A",scope:!0,templateUrl:"directives/chat/mobile-chat-top.tpl.html",link:function($scope,$element,$attr){$scope.isDisableVideo=$rootScope.DISPLAY.disableVideo,$scope.agent=Agents.agent,$scope.GLOBALS=$rootScope.GLOBALS,$scope.sentFeedback=!1,$scope.agentProfilePhoto=Agents.getAgentPhotoUrl(),$scope.classicView="CLASSIC"===$rootScope.DISPLAY.viewMode,$scope.showPhoneButton=$rootScope.DISPLAY.telephone&&$rootScope.DISPLAY.telephone.length>4&&$rootScope.DISPLAY.showPhoneBtn,$scope.circleColor={background:$rootScope.DISPLAY.mainColor,direction:"he"===$rootScope.DISPLAY.language?"rtl":"ltr"},$scope.borderedContainerStyle={background:"white",border:$rootScope.DISPLAY.mainColor},$scope.phoneHoverMsg="Ask for a phone call",$scope.phoneNumber=$rootScope.phoneNumber,$scope.isMobile=$rootScope.GLOBALS.isMobileUA,$scope.getAgentName=function(agent){return Utils.getAgentName(agent)};var feedback={init:function(){angular.extend($scope.feedback,Chat.customerFeedback.feedbackData),$scope.$watch(function(){return Chat.customerFeedback.feedbackData},function(newVal,oldVal){newVal!==oldVal&&angular.extend($scope.feedback,Chat.customerFeedback.feedbackData)})}};$scope.feedback={rankPressed:!1,isSendBtnDisabled:!1,rank:0,feedbackText:"",hover:0,sendFeedback:function(isFromBtn){Chat.customerFeedback.sendFeedback($scope.feedback.rank,$scope.feedback.feedbackText).then(function(){isFromBtn&&($scope.sentFeedback=!0,$scope.feedback.isSendBtnDisabled=!0,$timeout(function(){$scope.feedback.rankPressed=!1},2e3))})},showFeedback:function(){var parentFeedback=$scope.customerFeedback,isShowFeedback=Agents.agent&&Agents.agent.agentId&&Chat.clientMessagesCount>1&&Chat.agentMessagesCount>1&&Chat.clientMessagesCount+Chat.agentMessagesCount>6;return isShowFeedback&&("true"!==CacheFactory.get(CACHE_ENTRIES.feedbackMsg+"_"+Api.clientId)&&CacheFactory.set(CACHE_ENTRIES.feedbackMsg+"_"+Api.clientId,"true",3600),parentFeedback.isOpened=!0),isShowFeedback},starClass:function(starIdx){var classList="",rank=$scope.feedback.rank,hover=$scope.feedback.hover;return 0===starIdx&&(rank>0?classList="active":hover>0&&rank?classList="active":hover>0&&!rank&&(classList="hover")),1===starIdx&&(rank&&hover>1?classList="active":!hover&&rank>1?classList="active":hover>1&&rank?classList="active":hover>1&&!rank&&(classList="hover")),2===starIdx&&(rank&&hover>2?classList="active":!hover&&rank>2?classList="active":hover>2&&rank?classList="active":hover>2&&!rank&&(classList="hover")),3===starIdx&&(rank&&hover>3?classList="active":!hover&&rank>3?classList="active":hover>3&&rank?classList="active":hover>3&&!rank&&(classList="hover")),4===starIdx&&(rank&&hover>4?classList="active":!hover&&rank>4?classList="active":hover>4&&rank?classList="active":hover>4&&!rank&&(classList="hover")),classList},setRank:function(rank){$scope.feedback.rankPressed=!0,$scope.sentFeedback=!1,$scope.feedback.isSendBtnDisabled=!1,$scope.feedback.rank=rank,$scope.feedback.sendFeedback()},setStarHover:function(position){$scope.feedback.hover=position}},$scope.isRTL=function(str){var regex=/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/,rtlLetters=str.match(regex);return rtlLetters?{"margin-right":"-3px"}:!1},feedback.init(),$scope.$watch("agent.profilePicture",function(){$scope.agentProfilePhoto=Agents.getAgentPhotoUrl()}),$scope.showPhoneHoverMsg=function(){$scope.phoneHoverMsg=$scope.phoneHoverMsg=$rootScope.GLOBALS.showPhonePanel?"Close phone panel":"Ask for a phone call",$scope.showInMessageCenter($scope.phoneHoverMsg)},$scope.buttonsStyle={border:"1px solid white","margin-left":"0px"},$scope.photoBorderColor={"border-color":$rootScope.DISPLAY.mainColor},$scope.companyColor={color:$rootScope.DISPLAY.mainColor},$scope.toggleOnVideoChat=function(){$scope.openVideoChat(!$rootScope.GLOBALS.showVideoPanel)},$scope.toggleOnAudioChat=function(){$scope.openAudioChat(!$rootScope.GLOBALS.showVideoPanel)},$scope.toggleOnPhoneCall=function(){$scope.openPhoneCall(!$rootScope.GLOBALS.showPhonePanel)}}}}]),angular.module("proonto.ui").directive("video",["VideoFactory","$rootScope","CLIENT_ACTIONS","ChatFactory","$translate","$timeout","CONFIG",function(Video,$rootScope,CLIENT_ACTIONS,Chat,$translate,$timeout,CONFIG){return{restrict:"A",scope:!0,templateUrl:"directives/chat/video-drv.tpl.html",link:function($scope,$element,$attr){function getExpectedProtocol(){return"dev"===window.ENV.name?"http://":"https://"}function getWaitingMessageAgentName(){return $scope.agent&&$scope.agent.agentName?$scope.agent.agentName:$scope.anAgent}var translations=["video.AN_AGENT","video.WAITING_FOR"];$scope.video=Video,$scope.camBtnHoverMsg=Video.cameraActive?"toggle off camera":"toggle on camera",$scope.micBtnHoverMsg=Video.micActive?"toggle off microphone":"toggle on microphone",$rootScope.$watch("GLOBALS.showVideoPanel",function(){$translate(translations).then(function(returnedVal){$scope.anAgent=returnedVal["video.AN_AGENT"],$scope.waitingFor=returnedVal["video.WAITING_FOR"],$scope.waitingMsgAgentName=getWaitingMessageAgentName()})}),$scope.waitingMsgAgentName=getWaitingMessageAgentName(),$rootScope.$watch("DISPLAY.initialized",function(){$scope.userVideoStreamStyle={"background-color":$rootScope.DISPLAY.mainColor,"border-color":$rootScope.DISPLAY.mainColor},$scope.agentVideoStreamStyle={"border-color":$rootScope.DISPLAY.mainColor},$scope.waitingMsgStyle={color:$rootScope.DISPLAY.mainColor}}),$scope.toggleCamera=function(){Video.setCameraActive(!Video.cameraActive),Chat.sendAction(CLIENT_ACTIONS.clickCam)},$scope.toggleMic=function(){Video.setMicActive(!Video.micActive),Chat.sendAction(CLIENT_ACTIONS.clickMic),$scope.micBtnHoverMsg=Video.micActive?"toggle off microphone":"toggle on microphone"},$scope.isJoinEnabled=function(){var showJoin=CONFIG.url.indexOf(getExpectedProtocol())>-1&&!$scope.isDisableVideo;return showJoin&&void 0===Video.micActive&&Video.subscriber},$scope.showCamHoverMsg=function(){$scope.camBtnHoverMsg=Video.cameraActive?"toggle off camera":"toggle on camera",$scope.showInMessageCenter($scope.camBtnHoverMsg)},$scope.showMicHoverMsg=function(){$scope.micBtnHoverMsg=Video.micActive?"toggle off microphone":"toggle on microphone",$scope.showInMessageCenter($scope.micBtnHoverMsg)},$scope.join=function(){Video.cameraActive=!1,Video.micActive=!0,Video.startClientStream()}}}}]),angular.module("proonto.ui").directive("phone",["ChatFactory","$rootScope","$timeout","CONFIG",function(Chat,$rootScope,$timeout,CONFIG){return{restrict:"A",scope:!0,templateUrl:"directives/chat/phone.tpl.html",link:function($scope,$element,$attr){function validatePhoneNumber(){var number=$scope.telInput.intlTelInput("getNumber");return!number||number.length<7||!$scope.telInput.intlTelInput("isValidNumber")?(submitPhoneCallBtn.removeClass("active"),iconPhoneValid.removeClass("active"),iconPhoneInvalid.addClass("active"),!1):(submitPhoneCallBtn.addClass("active"),iconPhoneValid.addClass("active"),iconPhoneInvalid.removeClass("active"),!0)}var submitPhoneCallBtn=null,iconPhoneValid=null,iconPhoneInvalid=null;$timeout(function(){$scope.telInput=window.$(".phone-input"),submitPhoneCallBtn=window.$($element).find(".submitPhoneCall"),iconPhoneValid=window.$($element).find(".fa-check"),iconPhoneInvalid=window.$($element).find(".fa-close"),$scope.telInput.intlTelInput({nationalMode:!1,autoPlaceholder:!1}),$scope.$on("$destroy",function(){$scope.telInput.intlTelInput("destroy")}),$scope.telInput.blur(function($event){validatePhoneNumber()}),$scope.telInput.keyup(function($event){var isValid=validatePhoneNumber();isValid&&13===$event.keyCode&&$scope.startPhoneCall()})}),$scope.phonePlaceholder="(212) 123-4567",$scope.calling=!1,$scope.startPhoneCall=function(){validatePhoneNumber()&&(Chat.call($scope.telInput.intlTelInput("getNumber")),$scope.calling=!0,$timeout(function(){$scope.calling=!1,$rootScope.GLOBALS.showPhonePanel=!1},5e3))},$scope.closePhonePanel=function(){$rootScope.GLOBALS.showPhonePanel=!1}}}}]),angular.module("proonto.ui").directive("chatList",["$rootScope","ChatFactory","$timeout","AGENT_ACTIONS",function($rootScope,Chat,$timeout,AGENT_ACTIONS){return{restrict:"A",scope:!0,templateUrl:"directives/chat/chat-list.tpl.html",link:function($scope,$element,$attr){function setOldProperties(element){oldHeight=element.scrollHeight,oldTop=element.scrollTop,oldClientHeight=element.clientHeight}function scrollToBottom(){listElement.scrollTop=listElement.scrollHeight-listElement.clientHeight}function autoScroll(){var lastMsg=$scope.msgs[$scope.msgs.length-1];if(lastMsg){var shouldAutoScroll=lastMsg.content===AGENT_ACTIONS.openContactUsForm;shouldAutoScroll=shouldAutoScroll||oldTop+oldClientHeight+1>=oldHeight,$timeout(function(){(shouldAutoScroll||"CLIENT"===lastMsg.senderType)&&scrollToBottom(),setOldProperties(listElement)})}}function onMsgsLengthChanges(){autoScroll()}function doListResize(){$rootScope.GLOBALS.showVideoPanel?$scope.listStyle={"max-height":"136px"}:$rootScope.GLOBALS.showPhonePanel?$scope.listStyle={"max-height":"153px"}:$scope.listStyle={"max-height":"236px"}}function injectBackgroundColorToClientBubbleTriangle(){var style=document.createElement("style");document.head.appendChild(style),style.sheet.insertRule("#client-bubble:after {border-left-color: "+$rootScope.DISPLAY.secondaryColor+"}",0),style.sheet.insertRule("#client-bubble:after {border-right-color: "+$rootScope.DISPLAY.secondaryColor+"}",0),style.sheet.insertRule("#client-bubble:before {border-left-color: "+$rootScope.DISPLAY.mainColor+"}",0),style.sheet.insertRule("#client-bubble:before {border-right-color: "+$rootScope.DISPLAY.mainColor+"}",0),style.sheet.insertRule("#input-bubble:before {border-left-color: "+$rootScope.DISPLAY.mainColor+"}",0),style.sheet.insertRule("#input-bubble:before {border-right-color: "+$rootScope.DISPLAY.mainColor+"}",0),style.sheet.insertRule("#chat-contact-form-bubble:before {border-left-color: "+$rootScope.DISPLAY.mainColor+"}",0),style.sheet.insertRule("#chat-contact-form-bubble:before {border-right-color: "+$rootScope.DISPLAY.mainColor+"}",0)}$scope.listStyle={"max-height":"236px"},$("#chat-list-container-drv").perfectScrollbar(),$timeout(function(){var scrollRail=document.getElementsByClassName("ps-scrollbar-y-rail");scrollRail[0].style.backgroundColor=$rootScope.DISPLAY.secondaryColor,scrollRail[0].style.borderRadius="0";var scroller=document.getElementsByClassName("ps-scrollbar-y");scroller[0].style.backgroundColor=$rootScope.DISPLAY.mainColor,scroller[0].style.borderRadius="0"},500),angular.element($element[0].firstChild).bind("scroll",function(){setOldProperties($element[0].firstChild)}),$scope.isMessageActionContactForm=function(message){return"ACTION"===message.type&&message.content===AGENT_ACTIONS.openContactUsForm},$scope.msgs=Chat.messages;var oldHeight,oldTop,oldClientHeight,listElement=$element[0].firstChild;$timeout(function(){setOldProperties(listElement)},150),$scope.$watch("msgs.length",onMsgsLengthChanges),$rootScope.$watch("GLOBALS.showVideoPanel",doListResize),$rootScope.$watch("GLOBALS.showPhonePanel",doListResize),$timeout(function(){scrollToBottom(),setOldProperties(listElement)},100),injectBackgroundColorToClientBubbleTriangle()}}}]),angular.module("proonto.ui").directive("mobileChatList",["$rootScope","ChatFactory","$timeout","AGENT_ACTIONS",function($rootScope,Chat,$timeout,AGENT_ACTIONS){return{restrict:"A",scope:!0,templateUrl:"directives/chat/mobile-chat-list.tpl.html",link:function($scope,$element,$attr){function setOldProperties(element){oldHeight=element.scrollHeight,oldTop=element.scrollTop,oldClientHeight=element.clientHeight}function scrollToBottom(){listElement.scrollTop=listElement.scrollHeight-listElement.clientHeight}function autoScroll(){var lastMsg=$scope.msgs[$scope.msgs.length-1];if(lastMsg){var shouldAutoScroll=lastMsg.content===AGENT_ACTIONS.openContactUsForm;shouldAutoScroll=shouldAutoScroll||oldTop+oldClientHeight+1>=oldHeight,$timeout(function(){(shouldAutoScroll||"CLIENT"===lastMsg.senderType)&&scrollToBottom(),setOldProperties(listElement)})}}function onMsgsLengthChanges(){autoScroll()}$scope.msgs=Chat.messages,$(".proonto-conversation-body-parts").perfectScrollbar(),$timeout(function(){var scrollRail=document.getElementsByClassName("ps-scrollbar-y-rail");scrollRail[0].style.backgroundColor=$rootScope.DISPLAY.secondaryColor,scrollRail[0].style.borderRadius="0";var scroller=document.getElementsByClassName("ps-scrollbar-y");scroller[0].style.backgroundColor=$rootScope.DISPLAY.mainColor,scroller[0].style.borderRadius="0"},500),angular.element($element[0]).bind("scroll",function(){setOldProperties($element[0])});var oldHeight,oldTop,oldClientHeight,listElement=$(".proonto-conversation-body-parts")[0];$timeout(function(){setOldProperties(listElement)},150),$scope.$watch("msgs.length",onMsgsLengthChanges),$scope.$watch("GLOBALS.isKeyboardOpen",scrollToBottom),$timeout(function(){scrollToBottom(),setOldProperties(listElement)},1500)}}}]),angular.module("proonto.ui").filter("firstName",function(){return function(input,splitChar,splitIndex){return input.split(splitChar)[splitIndex]}}).directive("chatMessage",["$rootScope","ChatFactory","$translate",function($rootScope,Chat,$translate){return{restrict:"A",scope:{message:"="},templateUrl:"directives/chat/chat-message.tpl.html",link:function($scope,$element,$attr){$scope.isRTL=!1,$scope.isRTL=function(){var regex=/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/,clientName=$scope.message.senderName?$scope.message.senderName:$scope.clientName,str=(clientName?clientName:"")+$scope.message.content,rtlLetters=str.match(regex);return!!rtlLetters},$scope.id="agent-bubble","CLIENT"===$scope.message.senderType&&($scope.id="client-bubble"),$rootScope.$watch("GLOBALS.clientName",function(){"me"===$rootScope.GLOBALS.clientName?$translate("config.ME").then(function(returnedVal){$scope.clientName=returnedVal}):$scope.clientName=$rootScope.GLOBALS.clientName}),$scope.getBorderColor=function(){return"CLIENT"===$scope.message.senderType?$rootScope.DISPLAY.mainColor:void 0},$scope.getBackgroundColor=function(){return"CLIENT"===$scope.message.senderType?$rootScope.DISPLAY.secondaryColor:void 0},$scope.nameStyle={color:$rootScope.DISPLAY.mainColor,"background-color":$rootScope.DISPLAY.secondaryColor}}}}]),angular.module("proonto.ui").filter("firstName",function(){return function(input,splitChar,splitIndex){return input.split(splitChar)[splitIndex]}}).directive("mobileChatMessage",["$rootScope","ChatFactory","$translate",function($rootScope,Chat,$translate){return{restrict:"A",scope:{message:"="},templateUrl:"directives/chat/mobile-chat-message.tpl.html",link:function($scope,$element,$attr){$scope.isRTL=!1,$scope.isRTL=function(){var regex=/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/,clientName=$scope.message.senderName?$scope.message.senderName:$scope.clientName,str=(clientName?clientName:"")+$scope.message.content,rtlLetters=str.match(regex);return!!rtlLetters},$scope.id="agent-bubble","CLIENT"===$scope.message.senderType&&($scope.id="client-bubble"),$scope.messageStyle=function(message){var style1={"background-color":$rootScope.DISPLAY.mainColor},style2={"background-color":$rootScope.DISPLAY.secondaryColor},style="CLIENT"===message.senderType?style1:style2;return style},$rootScope.$watch("GLOBALS.clientName",function(){"me"===$rootScope.GLOBALS.clientName?$translate("config.ME").then(function(returnedVal){$scope.clientName=returnedVal}):$scope.clientName=$rootScope.GLOBALS.clientName}),$scope.getBorderColor=function(){return"CLIENT"===$scope.message.senderType?$rootScope.DISPLAY.mainColor:void 0},$scope.getBackgroundColor=function(){return"CLIENT"===$scope.message.senderType?$rootScope.DISPLAY.secondaryColor:void 0},$scope.nameStyle={color:$rootScope.DISPLAY.mainColor,"background-color":$rootScope.DISPLAY.secondaryColor}}}}]),angular.module("proonto.ui").directive("chatBottom",["$rootScope","CONFIG",function($rootScope,CONFIG){return{restrict:"A",scope:!0,templateUrl:"directives/chat/chat-bottom.tpl.html",link:function($scope,$element,$attr){function updateCSS(){$scope.companyColorStyle.right=$rootScope.percToPx(3,"width"),$scope.chatInputStyle.right=$rootScope.percToPx(11,"width"),$scope.chatInputStyle.width=$rootScope.percToPx(89,"width")}$scope.companyId=CONFIG.companyId,$scope.chatInputStyle={},$scope.whiteLabelWidget=CONFIG.whiteLabelWidget,$scope.companyColorStyle={color:$rootScope.DISPLAY.mainColor},$rootScope.GLOBALS.isMobileUA&&!$rootScope.GLOBALS.isTabletUA&&updateCSS(),$rootScope.$on("updateViewport",function(){$scope.$apply(function(){updateCSS()})}),$scope.clientBubbleStyle={"border-color":$rootScope.DISPLAY.mainColor,"background-color":$rootScope.DISPLAY.secondaryColor},$scope.proontoStyle={color:"inherit"},$scope.setProontoStyle=function(){$scope.proontoStyle={color:$rootScope.DISPLAY.mainColor}},$scope.clearProontoStyle=function(){$scope.proontoStyle={color:"inherit"}}}}}]),angular.module("proonto.ui").directive("chatBottomMobile",["$rootScope","$timeout","ChatFactory","CLIENT_ACTIONS","$translate","PubsubFactory","AgentFactory","ApiFactory",function($rootScope,$timeout,Chat,CLIENT_ACTIONS,$translate,Pubsub,AgentFactory,Api){return{restrict:"A",scope:!0,templateUrl:"directives/chat/chat-bottom-mobile.tpl.html",link:function($scope,$element,$attr){var isTyping=!1,typingTimeout=null;$scope.isTypingText="",Pubsub.on(Api.EVENTS.agentIsTyping,null,function(event){var translations=["actions.IS_TYPING"];$translate(translations).then(function(returnedVal){var agentName=AgentFactory.agent.agentName;"he"===$rootScope.DISPLAY.language&&(agentName=AgentFactory.agent.foreignName),$scope.isTypingText=agentName+" "+returnedVal["actions.IS_TYPING"]+"...",$timeout(function(){$scope.isTypingText=""},2e3)})}),$scope.sendButtonStyle=function(){var style={};return style="he"===$rootScope.DISPLAY.language?{background:$rootScope.DISPLAY.mainColor,left:"5px"}:{background:$rootScope.DISPLAY.mainColor,right:"5px"}},$scope.textAreaStyle=function(){var style={};return style="he"===$rootScope.DISPLAY.language?{"padding-right":"30px","padding-left":"100px",direction:"rtl"}:{"padding-right":"100px","padding-left":"30px"}},$scope.isTypingStyle=function(){var style={};return"he"===$rootScope.DISPLAY.language?style={direction:"rtl"}:!1},$scope.sendMessage=function(){""!==$scope.messageBody&&(Chat.sendText($scope.messageBody,$scope.realName),$scope.messageBody="")},$scope.messageKeyDown=function($event){13!==$event.keyCode||$event.shiftKey?isTyping||(isTyping=!0,Chat.sendAction(CLIENT_ACTIONS.typing),typingTimeout=$timeout(function(){isTyping=!1,Chat.sendAction(CLIENT_ACTIONS.stopTyping)},2e3)):($event.preventDefault(),$timeout.cancel(typingTimeout),isTyping=!1,$scope.sendMessage())}}}}]),angular.module("proonto.ui").directive("chatInput",["$rootScope","$timeout","ChatFactory","CLIENT_ACTIONS","$translate",function($rootScope,$timeout,Chat,CLIENT_ACTIONS,$translate){return{restrict:"A",scope:!0,templateUrl:"directives/chat/chat-input.tpl.html",link:function($scope,$element,$attr){function isDesktop(){return $rootScope.GLOBALS.isDesktopUA}function toDisplayedName(name){return angular.uppercase(name)+":"}function getTextareaInlineStyle(){var width=$element[0].querySelector(".name-span").clientWidth+2;return{"text-indent":width+"px"}}function bindEvents(){if(isDesktop()){var target=$element[0].querySelector("#edit-name-link");$rootScope.bindEvent("mouseenter",target,$scope.showInMessageCenter,["Click to enter your name"])}}function sendMessage(){""!==$scope.messageBody&&(Chat.sendText($scope.messageBody,$scope.realName),$scope.messageBody="",$scope.overflown=!1)}function setNameSpanVisibility(){var textAreaElement=document.querySelector("#chat-input-textarea"),scrollTop=textAreaElement.scrollTop;$scope.overflown=scrollTop>5}autosize(document.querySelector("#chat-input-textarea")),$scope.realName=$rootScope.GLOBALS.clientName,$translate("config.ME").then(function(returnedVal){$scope.realName&&"me"!==$scope.realName||($scope.realName=returnedVal)}),$scope.displayedName=toDisplayedName($scope.realName),$scope.$watch("realName",function(newVal,oldVal,scope){$scope.displayedName=toDisplayedName(newVal)}),$scope.nameStyle={color:$rootScope.DISPLAY.mainColor},$scope.textAreaInlineStyle=null,$scope.$watch("displayedName",function(newVal,oldVal,scope){$timeout(function(){$scope.textAreaInlineStyle=getTextareaInlineStyle()})}),$scope.isEditName=!1;var isTyping=!1,typingTimeout=null;$scope.overflown=!1,$scope.messageBody="",$scope.inputBubbleStyle={"border-color":$rootScope.DISPLAY.mainColor},$scope.editName=function(){$scope.isEditName=!0,$scope.realName="",$timeout(function(){angular.element($element)[0].querySelector("#edit-name-input").focus()})},$scope.isRTL=function(){var currentStateIsRTL=angular.element($element)[0].querySelector(".input-bubble-rtl"),clientName=$scope.realName;if(void 0!==currentStateIsRTL&&""===clientName)return!0;if(""===clientName)return!1;var regex=/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/,rtlLetters=clientName.match(regex);return!!rtlLetters},$scope.nameKeyPressed=function($event){13!==$event.keyCode||$event.shiftKey||$scope.exitEditName()},$scope.exitEditName=function(){$scope.isEditName&&($scope.isEditName=!1,$scope.realName&&0!==$scope.realName.length?Chat.sendClientName($scope.realName):$scope.realName=$rootScope.GLOBALS.clientName,$timeout(function(){isDesktop()&&angular.element($element)[0].querySelector("#chat-input-textarea").focus()}))},$scope.mouseClicked=function(){$scope.isEditName?$scope.exitEditName():setNameSpanVisibility()},$scope.messageKeyUp=function(){setNameSpanVisibility()},$scope.messageKeyDown=function($event){setNameSpanVisibility(),13!==$event.keyCode||$event.shiftKey?isTyping||(isTyping=!0,Chat.sendAction(CLIENT_ACTIONS.typing),typingTimeout=$timeout(function(){isTyping=!1,Chat.sendAction(CLIENT_ACTIONS.stopTyping)},2e3)):($event.preventDefault(),$timeout.cancel(typingTimeout),isTyping=!1,sendMessage())},bindEvents(),isDesktop()&&$element[0].querySelector(".chat-input-textarea").focus()}}}]),angular.module("proonto.ui").directive("contactDetails",["$rootScope","$timeout","CacheFactory","CACHE_ENTRIES","$translate","$q",function($rootScope,$timeout,Cache,CACHE_ENTRIES,$translate,$q){return{restrict:"A",scope:!0,templateUrl:"directives/welcome/contact-details.tpl.html",link:function($scope,$element,$attr){function calcFormValid(){$scope.isFormValid=$scope.isNameValid&&$scope.isEmailValid&&$scope.isPhoneSet&&$scope.isPhoneValid&&$scope.isMsgValid}$scope.contactUsTitle=$rootScope.DISPLAY.offlineFormTitle,$scope.contactUsSubTitle=$rootScope.DISPLAY.offlineFormText,$scope.isNameSet=!1,$scope.isNameValid=null,$scope.isEmailSet=!1,$scope.isEmailValid=null,$scope.isPhoneSet=!1,$scope.isPhoneValid=null,$scope.isMsgSet=!1,$scope.isMsgValid=null,$scope.isFormValid=!1,$scope.submitStatusEnum={NOT_STARTED:0,FAILURE:1,SUCCESS:2},$scope.submitStatus=$scope.submitStatusEnum.NOT_STARTED,$scope.titleFontSize=null,$scope.subTitleFontSize=null,$scope.contactStyle={background:$rootScope.DISPLAY.mainColor},$scope.triangleStyle={"border-left-color":$rootScope.DISPLAY.mainColor},$scope.showContent=!1,$scope.clientDetails={},$scope.showContactForm=!1;var placeholder="",translations=["placeholders.NAME","placeholders.PHONE","placeholders.EMAIL","placeholders.MESSAGE","placeholders.SEND"];$translate(translations).then(function(returnedVal){$scope.clientDetails.name.placeholder=$scope.clientDetails.name.defaultPlaceholder=returnedVal["placeholders.NAME"],$scope.clientDetails.phone.placeholder=$scope.clientDetails.phone.defaultPlaceholder=returnedVal["placeholders.PHONE"],$scope.clientDetails.email.placeholder=$scope.clientDetails.email.defaultPlaceholder=returnedVal["placeholders.EMAIL"],$scope.clientDetails.msg.placeholder=$scope.clientDetails.msg.defaultPlaceholder=returnedVal["placeholders.MESSAGE"],$scope.clientDetails.send.placeholder=$scope.clientDetails.send.defaultPlaceholder=returnedVal["placeholders.SEND"]}),$scope.clientDetails.name={errorMsg:null,isRequired:!0,isValid:!1,value:null},placeholder="SEND",$scope.clientDetails.send={defaultPlaceholder:placeholder},placeholder="EMAIL",$scope.clientDetails.email={defaultPlaceholder:placeholder,errorMsg:null,isRequired:!0,isValid:!1,placeholder:placeholder,value:$rootScope.GLOBALS.clientEmail},placeholder="PHONE",$scope.clientDetails.phone={defaultPlaceholder:placeholder,isRequired:!1,isValid:!0,errorMsg:null,placeholder:placeholder,value:null},placeholder="MESSAGE",$scope.clientDetails.msg={defaultPlaceholder:placeholder,isRequired:!0,isValid:!1,errorMsg:null,placeholder:placeholder,value:null},$scope.setPlaceholder=function(fieldId,placeholderVal){var currentField=$scope.clientDetails[fieldId];currentField.value||(placeholderVal&&$translate("placeholders."+placeholderVal).then(function(returnedVal){currentField.placeholder=returnedVal}),currentField.placeholder=placeholderVal)},$scope.validateName=function(){var isValid=!0;return $scope.isNameSet=!0,$scope.clientDetails.name.value||(isValid=!1),$scope.isNameValid=isValid,calcFormValid(),$scope.isNameValid},$scope.closeContactUsForm=function(){$scope.showContactForm=!1,$timeout(function(){$scope.switchDisplay($scope.getInitialState()),Cache.set(CACHE_ENTRIES.displayState,$scope.getInitialState(),40)},500)},$scope.isShowPhoneCheck=function(){return null!==$scope.clientDetails.phone.value&&$scope.clientDetails.phone.value.length>0&&$scope.validatePhone()},$scope.validateEmail=function(){var isValid=!0;return $scope.isEmailSet=!0,$scope.clientDetails.email.value&&$scope.validateEmailFormat($scope.clientDetails.email.value)||(isValid=!1),$scope.isEmailValid=isValid,calcFormValid(),$scope.isEmailValid},$scope.validatePhone=function(){var isValid=!0;return $scope.clientDetails.phone.value?$scope.isPhoneSet=!0:$scope.isPhoneSet=!1,$scope.isPhoneSet&&!$scope.validatePhoneFormat($scope.clientDetails.phone.value)&&(isValid=!1),$scope.isPhoneValid=isValid,calcFormValid(),$scope.isPhoneValid},$scope.validateMsg=function(){var isValid=!0;return $scope.isMsgSet=!0,$scope.clientDetails.msg.value||(isValid=!1),$scope.isMsgValid=isValid,calcFormValid(),$scope.isMsgValid},$scope.validateForm=function(){var isValid=$scope.validateName();return isValid=$scope.validateEmail()&&isValid,isValid=$scope.validatePhone()&&isValid,isValid=$scope.validateMsg()&&isValid,$scope.isFormValid=isValid,isValid},$scope.submit=function(){if($scope.validateForm()){var clientDetailsToSend={};clientDetailsToSend.name=$scope.clientDetails.name.value,clientDetailsToSend.email=$scope.clientDetails.email.value,clientDetailsToSend.phone=$scope.clientDetails.phone.value,clientDetailsToSend.msg=$scope.clientDetails.msg.value,$scope.innerSetClientDetails(clientDetailsToSend,!0).then(function(response){$scope.submitStatus=$scope.submitStatusEnum.SUCCESS,$rootScope.GLOBALS.clientName=$scope.clientDetails.name.value,$rootScope.GLOBALS.clientEmail=$scope.clientDetails.email.value,$timeout(function(){$scope.switchDisplay($scope.getInitialState())},1e3)})["catch"](function(){$scope.submitStatus=$scope.submitStatusEnum.FAILURE})}};var adjustTitleFontSize=function(){var titleElem=$element[0].querySelector(".title"),maxHeight=window.getComputedStyle(titleElem).maxHeight;maxHeight=maxHeight.substring(0,maxHeight.length-2);var titleTextElem=$element[0].querySelector(".title > .font"),height=titleTextElem.offsetHeight;if(height>maxHeight){var fontSize=window.getComputedStyle(titleTextElem).fontSize;fontSize=fontSize.substring(0,fontSize.length-2)-1+"px",$scope.titleFontSize={"font-size":fontSize},$timeout(adjustTitleFontSize)}};$timeout(adjustTitleFontSize);var adjustSubTitleFontSize=function(){var titleElem=$element[0].querySelector(".subtitle"),maxHeight=window.getComputedStyle(titleElem).maxHeight;maxHeight=maxHeight.substring(0,maxHeight.length-2);var titleTextElem=$element[0].querySelector(".subtitle > .font"),height=titleTextElem.offsetHeight;if(height>maxHeight){var fontSize=window.getComputedStyle(titleTextElem).fontSize;fontSize=fontSize.substring(0,fontSize.length-2)-1+"px",$scope.titleFontSize={"font-size":fontSize},$timeout(adjustTitleFontSize)}};$timeout(adjustSubTitleFontSize),$scope.isActive=function(){return null!==$scope.clientDetails.name.value&&$scope.clientDetails.name.value.length>0&&null!==$scope.clientDetails.email.value&&0!==$scope.clientDetails.email.value.length&&$scope.validateEmailFormat($scope.clientDetails.email.value)&&(null===$scope.clientDetails.phone.value||0===$scope.clientDetails.phone.value.length||$scope.validatePhone())&&null!==$scope.clientDetails.msg.value&&$scope.clientDetails.msg.value.length>0},$timeout(function(){$scope.showContent=!0},350),$timeout(function(){$scope.showContactForm=!0},45)}}}]),angular.module("proonto.ui").directive("onlineWelcome",["$rootScope","$timeout","CONFIG","AgentFactory","ChatFactory",function($rootScope,$timeout,CONFIG,Agents,Chat){return{restrict:"A",scope:!0,templateUrl:"directives/welcome/online-welcome.tpl.html",link:function($scope,$element,$attr){function checkRTL(phrase){var regex=/[\u0590-\u05FF]/,rtlLetters=phrase.match(regex);rtlLetters?$scope.isRTL="rtl":$scope.isRTL="ltr"}function initOnline(){$scope.isOnline?($scope.onlineOfflineClass="online",CONFIG.screenType===DEVICE_TYPES.DESKTOP?(checkRTL($rootScope.DISPLAY.onlineButtonText),$scope.ctaText=$rootScope.DISPLAY.onlineButtonText):$scope.ctaText=""):($scope.onlineOfflineClass="offline",CONFIG.screenType===DEVICE_TYPES.DESKTOP?(checkRTL($rootScope.DISPLAY.offlineButtonText),$scope.ctaText=$rootScope.DISPLAY.offlineButtonText):$scope.ctaText="")}$scope.agent=Agents.agent,$scope.blink="no-blink",$scope.badge="no-badge",$scope.agentProfilePhoto=Agents.getAgentPhotoUrl(),$scope.$watch("agent.profilePicture",function(){$scope.agentProfilePhoto=Agents.getAgentPhotoUrl()}),$scope.$watch("GLOBALS.blinkForNewMessage",function(){$scope.blink=$rootScope.GLOBALS.blinkForNewMessage?"blink":"no-blink"}),$scope.$watch("GLOBALS.badgeValue",function(){$scope.isOnline&&($scope.badge=$rootScope.GLOBALS.badgeValue>0?"badge":"no-badge",$scope.badgeValue=$rootScope.GLOBALS.badgeValue)}),$scope.$watch("GLOBALS.displayState",function(){$scope.display=$rootScope.GLOBALS.displayState,$scope.pacmanClass=$scope.display===$scope.DisplayForm.onlineEntrance?"wave-animation":"wave-animation2"}),$scope.agentProfilePhoto=Agents.getAgentPhotoUrl(),$scope.isOnline=$rootScope.GLOBALS.online,$scope.$watch("GLOBALS.online",function(){$scope.isOnline=$rootScope.GLOBALS.online,initOnline()}),$scope.shape=$rootScope.DISPLAY.shape,$scope.symbol=$rootScope.DISPLAY.symbol,$scope.customButtonStyle={"background-color":$rootScope.DISPLAY.mainColor,color:$rootScope.DISPLAY.textColor},$scope.customColor=$rootScope.DISPLAY.mainColor,$scope.triangleStyle={"border-left-color":$rootScope.DISPLAY.mainColor},$scope.pacmanStyle={color:$rootScope.DISPLAY.mainColor},$scope.ctaButtonStyle={color:$rootScope.DISPLAY.mainColor,"text-shadow":"-1px -1px 0 white,1px -1px 0 white,-1px 1px 0 white, 1px 1px 0 white"
},$scope.ctaButtonStyle2={color:$rootScope.DISPLAY.secondaryColor,"text-shadow":"-1px -1px 0 "+$rootScope.DISPLAY.mainColor+",1px -1px 0 "+$rootScope.DISPLAY.mainColor+",-1px 1px 0 "+$rootScope.DISPLAY.mainColor+",1px 1px 0 "+$rootScope.DISPLAY.mainColor},$scope.isRTL=null,$scope.onlineOfflineClass=null,initOnline(),"classic"!==$scope.shape&&$timeout(function(){if($rootScope.GLOBALS.displayState!==$scope.DisplayForm.none){var customButtonWidth=document.getElementsByClassName("ctaText")[0].clientWidth+50;$rootScope.$emit("actualCustomButtonWidth",customButtonWidth)}},300),$scope.isDesktopScreen=function(){return CONFIG.screenType===DEVICE_TYPES.DESKTOP}}}}]),angular.module("proonto.ui").directive("pacmanStyle",["$rootScope","AgentFactory","$timeout",function($rootScope,Agents,$timeout){return{restrict:"A",scope:!0,templateUrl:"directives/welcome/pacman-style.tpl.html",link:function($scope,$element,$attr){$scope.display=$rootScope.GLOBALS.displayState,$scope.showPacman=function(){return $scope.agentProfilePhoto.indexOf("assets/avatar.png")>-1?!0:$scope.display!==DisplayForm.onlineEntrance||!$rootScope.GLOBALS.online},$scope.agent=Agents.agent,$scope.pacmanStyle={color:$rootScope.DISPLAY.mainColor},$scope.agentProfilePhoto=Agents.getAgentPhotoUrl(),$scope.circleColor={background:$rootScope.DISPLAY.mainColor},$scope.photoBorderColor={"border-color":$rootScope.DISPLAY.mainColor},$scope.pacmanClass=$scope.display===$scope.DisplayForm.onlineEntrance?"wave-animation":"wave-animation2",$scope.$watch("agent.profilePicture",function(){$scope.agentProfilePhoto=Agents.getAgentPhotoUrl()}),$scope.$watch("GLOBALS.displayState",function(){$scope.display=$rootScope.GLOBALS.displayState,$scope.pacmanClass=$scope.display===$scope.DisplayForm.onlineEntrance?"wave-animation":"wave-animation2"}),$timeout(function(){if($element[0].querySelector(".wave-animation")){var elm=$element[0].querySelector(".wave-animation").parentElement;elm.style.display="none",$timeout(function(){var elm=$element[0].querySelector(".wave-animation").parentElement;elm.style.display="block"})}})}}}]),angular.module("proonto.ui").directive("invitation",["$rootScope","$timeout","AgentFactory","ChatFactory","CLIENT_ACTIONS",function($rootScope,$timeout,Agents,Chat,CLIENT_ACTIONS){return{restrict:"A",scope:!0,templateUrl:"directives/invitation/invitation.tpl.html",link:function($scope,$element,$attr){$scope.agentProfilePhoto=Agents.getAgentPhotoUrl(),$scope.animateInvitation=!1,$scope.invitationText=$rootScope.DISPLAY.invitationText,$scope.invitationButton={"background-color":$rootScope.DISPLAY.mainColor,"border-Color":$rootScope.DISPLAY.mainColor},$scope.invitationBorderColor={"border-Color":$rootScope.DISPLAY.mainColor},$timeout(function(){$scope.animateInvitation=!0},100),$scope.acceptInvitation=function(){$scope.openChat(),Chat.sendAction(CLIENT_ACTIONS.acceptInvitation)},$scope.closeInvitation=function(){$scope.switchDisplay($scope.getInitialState()),Chat.sendAction(CLIENT_ACTIONS.closeInvitation)}}}}]),angular.module("proonto.ui").directive("chatLead",["$rootScope","$timeout","CacheFactory","CACHE_ENTRIES",function($rootScope,$timeout,Cache,CACHE_ENTRIES){return{restrict:"A",scope:!0,templateUrl:"directives/welcome/chat-lead.tpl.html",link:function($scope,$element,$attr){$scope.contactUsTitle=$rootScope.DISPLAY.offlineFormTitle,$scope.contactUsSubTitle=$rootScope.DISPLAY.offlineFormText,$scope.isNameSet=!1,$scope.isNameValid=null,$scope.isEmailSet=!1,$scope.isEmailValid=null,$scope.isPhoneSet=!1,$scope.isPhoneValid=null,$scope.titleFontSize=null,$scope.subTitleFontSize=null,$scope.sent=!1,$scope.showContent=!1,$scope.inlineStyle={background:$rootScope.DISPLAY.mainColor},$scope.triangleStyle={"border-left-color":$rootScope.DISPLAY.mainColor},$scope.showContactForm=!1,$scope.clientDetails={};var placeholder="NAME";$scope.clientDetails.name={defaultPlaceholder:placeholder,errorMsg:null,isRequired:!0,isValid:!1,placeholder:placeholder,value:null},placeholder="EMAIL",$scope.clientDetails.email={defaultPlaceholder:placeholder,errorMsg:null,isRequired:!0,isValid:!1,placeholder:placeholder,value:$rootScope.GLOBALS.clientEmail},placeholder="PHONE",$scope.clientDetails.phone={defaultPlaceholder:placeholder,isRequired:!1,isValid:!0,errorMsg:null,placeholder:placeholder,value:null},$scope.setPlaceholder=function(fieldId,placeholderVal){var currentField=$scope.clientDetails[fieldId];currentField.value||(currentField.placeholder=placeholderVal)},$scope.validateName=function(){var isValid=!0;return $scope.isNameSet=!0,$scope.clientDetails.name.value||(isValid=!1),$scope.isNameValid=isValid,$scope.isNameValid},$scope.validateEmail=function(){var isValid=!0;return $scope.isEmailSet=!0,$scope.clientDetails.email.value&&$scope.validateEmailFormat($scope.clientDetails.email.value)||(isValid=!1),$scope.isEmailValid=isValid,$scope.isEmailValid},$scope.validatePhone=function(){var isValid=!0;return $scope.clientDetails.phone.value?$scope.isPhoneSet=!0:$scope.isPhoneSet=!1,$scope.isPhoneSet&&!$scope.validatePhoneFormat($scope.clientDetails.phone.value)&&(isValid=!1),$scope.isPhoneValid=isValid,$scope.isPhoneValid},$scope.validateForm=function(){var isValid=$scope.validateName();return isValid=$scope.validateEmail()&&isValid,isValid=$scope.validatePhone()&&isValid},$scope.submit=function(){if($scope.validateForm()){var clientDetailsToSend={};clientDetailsToSend.name=$scope.clientDetails.name.value,clientDetailsToSend.email=$scope.clientDetails.email.value,clientDetailsToSend.phone=$scope.clientDetails.phone.value,$scope.innerSetClientDetails(clientDetailsToSend,!0),$rootScope.GLOBALS.clientName=$scope.clientDetails.name.value,$rootScope.GLOBALS.clientEmail=$scope.clientDetails.email.value,$scope.sent=!0,$timeout(function(){$scope.switchDisplay($scope.DisplayForm.onlineChat),Cache.set(CACHE_ENTRIES.displayState,$scope.DisplayForm.onlineChat,40)},1e3)}};var adjustTitleFontSize=function(){var titleElem=$element[0].querySelector(".title"),maxHeight=window.getComputedStyle(titleElem).maxHeight;maxHeight=maxHeight.substring(0,maxHeight.length-2);var titleTextElem=$element[0].querySelector(".title > .font"),height=titleTextElem.offsetHeight;if(height>maxHeight){var fontSize=window.getComputedStyle(titleTextElem).fontSize;fontSize=fontSize.substring(0,fontSize.length-2)-1+"px",$scope.titleFontSize={"font-size":fontSize},$timeout(adjustTitleFontSize)}};$timeout(adjustTitleFontSize);var adjustSubTitleFontSize=function(){var titleElem=$element[0].querySelector(".subtitle"),maxHeight=window.getComputedStyle(titleElem).maxHeight;maxHeight=maxHeight.substring(0,maxHeight.length-2);var titleTextElem=$element[0].querySelector(".subtitle > .font"),height=titleTextElem.offsetHeight;if(height>maxHeight){var fontSize=window.getComputedStyle(titleTextElem).fontSize;fontSize=fontSize.substring(0,fontSize.length-2)-1+"px",$scope.titleFontSize={"font-size":fontSize},$timeout(adjustTitleFontSize)}};$timeout(adjustSubTitleFontSize),$scope.isActive=function(){return null!==$scope.clientDetails.name.value&&$scope.clientDetails.name.value.length>0&&null!==$scope.clientDetails.email.value&&0!==$scope.clientDetails.email.value.length&&$scope.validateEmailFormat($scope.clientDetails.email.value)&&(null===$scope.clientDetails.phone.value||0===$scope.clientDetails.phone.value.length||$scope.validatePhone())},$scope.isShowPhoneCheck=function(){return null!==$scope.clientDetails.phone.value&&$scope.clientDetails.phone.value.length>0&&$scope.validatePhone()},$timeout(function(){$scope.showContent=!0},350),$timeout(function(){$scope.showContactForm=!0},45),$scope.closeChatLeadForm=function(){$scope.showContactForm=!1,$timeout(function(){$scope.switchDisplay($scope.getInitialState()),Cache.set(CACHE_ENTRIES.displayState,$scope.getInitialState(),40)},500)}}}}]),angular.module("proonto.ui").directive("calcLang",["$timeout",function($timeout){return{restrict:"A",scope:!0,link:function($scope,$element,$attr){function getValue(){return"span"===$element[0].nodeName.toLowerCase()?$element.html().trim():$element.val().trim()}function getLang(char){return char.charCodeAt(0)>=1425&&char.charCodeAt(0)<=1524?"iw":"en"}$timeout(function(){var text=getValue();$element.attr("lang",getLang(text))})}}}]),angular.module("proonto.app").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("directives/chat/chat-bottom-mobile.tpl.html",'<div class="chat-bottom-mobile-container" id="chat-bottom-mobile-drv"><div class="isTypingField" ng-style="isTypingStyle()">{{isTypingText}}</div><pre><br></pre><textarea ng-style="textAreaStyle()" tabindex="-1" ng-blur="sendBlur($event)" ng-focus="sendFocus($event)" data-ng-model="messageBody" ng-keydown="messageKeyDown($event)" placeholder="Send a message..."></textarea><div class="buttons"><span ng-show="messageBody !== \'\'" ng-style="sendButtonStyle()" ng-click="sendMessage();" class="circle send-button"><i id="send-message" class="send-message-button-icon fa fa-send"></i></span></div></div>'),$templateCache.put("directives/chat/chat-bottom.tpl.html",'<div id="chat-bottom-drv" class="chat-bottom-container"><span ng-style="companyColorStyle" class="icon-proonterFull proonto-pacman-input"></span><div chat-input class="chat-input" ng-style="chatInputStyle"></div><div class="bottom-row" ng-mouseenter="setProontoStyle()" ng-mouseleave="clearProontoStyle()" ng-hide="whiteLabelWidget ===\'true\'">{{"footer.POWERED_BY" | translate}}&nbsp;<a href="https://proonto.com/free-live-chat/?utm_source=powered_by&utm_medium=base&utm_campaign={{companyId}}" id="proonto-link" ng-style="proontoStyle" target="_blank">PROONTO</a></div><div ng-show="GLOBALS.messageCenter!=null" ng-class="{rtl: DISPLAY.language == \'he\' }" class="messages-center center" ng-style="clientBubbleStyle">{{GLOBALS.messageCenter}}</div></div>'),$templateCache.put("directives/chat/chat-contact-form.tpl.html",'<div ng-style="inlineStyle" id="chat-contact-form-bubble" class="bounceIn chat-contact-form-bubble"><form ng-hide="requestStatus != requestStatusEnum.NOT_STARTED"><div class="row name" ng-style="contactFormStyle"><i class="fa fa-close" ng-show="clientDetails.name.length === 0"></i> <i class="fa fa-check" ng-show="clientDetails.name.length > 0"></i> <input id="name" name="name" ng-model="clientDetails.name" class="form-control" ng-keyup="keyUp($event)" placeholder="{{placeholders.name}}" ng-style="contactFormStyle"> <span class="pad-str">*</span></div><div class="row email" ng-style="contactFormStyle"><i class="fa fa-close" ng-show="clientDetails.email !== null && !validateEmailFormat(clientDetails.email);"></i> <i class="fa fa-check" ng-show="clientDetails.email.length > 0 && validateEmailFormat(clientDetails.email);"></i> <input id="email" name="email" ng-model="clientDetails.email" class="form-control" ng-style="contactFormStyle" type="email" ng-keyup="keyUp($event)" placeholder="{{placeholders.email}}"> <span class="pad-str">*</span></div><div class="row phone" ng-style="contactFormStyle"><input id="phone" name="phone" ng-model="clientDetails.phone" class="form-control" ng-style="contactFormStyle" type="tel" ng-keyup="keyUp($event)" placeholder="{{placeholders.phone}}"></div><input id="submit-in-chat-contact" type="submit" value="{{placeholders.send}}" ng-click="submit()" ng-class="validateForm() ? \'active\' : \'\'"></form><span ng-hide="requestStatus == requestStatusEnum.NOT_STARTED"><div class="chat-contact-form-success" ng-if="requestStatus == requestStatusEnum.SUCCESS"><i class="fa fa-check"></i></div><div class="chat-contact-form-fail" ng-if="requestStatus == requestStatusEnum.FAILURE"><div>Something went wrong!</div><div>Please reload the page</div><div>or contact support</div></div></span></div>'),$templateCache.put("directives/chat/chat-input.tpl.html",'<div id="input-bubble" ng-style="inputBubbleStyle" ng-class="isRTL() ? \'input-bubble-rtl\' : \'input-bubble\'"><span class="name-span" id="edit-name-link" ng-style="nameStyle" ng-hide="overflown" ng-click="editName()">{{displayedName}}<md-tooltip md-direction="top" md-delay="0">Enter name</md-tooltip></span> <input id="edit-name-input" ng-model="realName" ng-show="isEditName" ng-keypress="nameKeyPressed($event)" ng-blur="exitEditName()" placeholder="type your name" maxlength="13" ng-focus="sendFocus($event)" ng-blur="sendBlur($event)"><textarea id="chat-input-textarea" class="chat-input-textarea" rows="1" data-ng-style="textAreaInlineStyle" data-ng-model="messageBody" data-ng-trim="true" ng-keyup="messageKeyUp($event)" ng-keydown="messageKeyDown($event)" ng-focus="sendFocus($event)" ng-blur="sendBlur($event)"></textarea></div>'),$templateCache.put("directives/chat/chat-list.tpl.html",'<div id="chat-list-container-drv" class="chat-list-container" ng-style="listStyle"><div ng-repeat="message in msgs "><div chat-message message="message" ng-if="message.type==\'TEXT\'"></div><div chat-contact-form ng-if="isMessageActionContactForm(message)"></div></div>'),$templateCache.put("directives/chat/chat-message.tpl.html","<div id=\"{{id}}\" class=\"bounceInMessage\" ng-class=\"{'client-bubble':message.senderType==='CLIENT', 'agent-bubble':message.senderType==='AGENT', 'system-bubble':message.senderType==='SYSTEM','rtl': isRTL()}\" ng-style=\"{'border-color': getBorderColor(), 'background-color': getBackgroundColor()}\"><span ng-if=\"message.senderType==='CLIENT'\" ng-style=\"nameStyle\" style=\"margin-right: -2px\">{{clientName}}:</span> <span ng-if=\"message.senderType!=='CLIENT' &&   message.senderType!=='SYSTEM' \">{{message.senderName | firstName:' ':0}}:</span>&nbsp<span style=\"text-rendering: auto\" class=\"msgtxt\" ng-bind-html=\"message.content | linky:'_blank'\"></span> <span ng-if=\"message.state == 'SENDING'\">(SENDING)</span></div>"),$templateCache.put("directives/chat/chat-top.tpl.html",'<div id="chat-top-drv" class="chat-top-container center" ng-hide="GLOBALS.isKeyboardOpen"><div class="bordered-container" ng-style="borderedContainerStyle" ng-show="!GLOBALS.showVideoPanel"><div class="agent-details"><div ng-if="agent.agentName" class="half-circle center"></div><div ng-if="agent.agentName" id="img-container" class="agent-img-container center" ng-style="photoBorderColor"><img ng-if="agent.agentName" ng-mouseenter="showInMessageCenter(agent.agentName)" class="agent-round-image" ng-src="{{agentProfilePhoto}}"></div><div ng-if="agent.agentName" class="buttons" ng-show="!isDisableVideo && !isMobile"><span class="circle" ng-style="circleColor" ng-click="toggleOnVideoChat()" ng-mouseenter="showInMessageCenter(\'Ask for a video chat\')" ng-hide="GLOBALS.showPhonePanel"><md-tooltip md-direction="top" md-delay="0">Video chat</md-tooltip><span id="video-chat-button" class="icon-video menu-icon"></span></span> <span class="circle" ng-style="circleColor" ng-click="toggleOnAudioChat()" ng-mouseenter="showInMessageCenter(\'Ask for an audio chat\')" ng-hide="GLOBALS.showPhonePanel"><md-tooltip md-direction="top" md-delay="0">Audio chat</md-tooltip><span id="audio-chat-button" class="icon-mic menu-icon"></span></span> <span class="circle" ng-style="circleColor" ng-show="showPhoneButton" ng-click="toggleOnPhoneCall()" ng-mouseenter="showPhoneHoverMsg()"><md-tooltip md-direction="top" md-delay="0">Free call</md-tooltip><span id="phone-call-button" ng-class="GLOBALS.showPhonePanel ? \'icon-no-phone menu-icon\' : \'icon-phone menu-icon\'"></span></span></div><div class="buttons" ng-show="isDisableVideo && !isMobile"><span class="circle" ng-show="showPhoneButton" ng-style="circleColor" ng-click="toggleOnPhoneCall()" ng-mouseenter="showInMessageCenter(\'Ask for a phone call\')"><span id="phone-call-button-when-video-disabled" class="icon-phone menu-icon"></span></span></div><div ng-if="agent.agentName" class="buttons" ng-show="isMobile"><span class="circle" ng-show="showPhoneButton" ng-style="circleColor" ng-mouseenter="showInMessageCenter(\'Ask for a phone call\')"><a href="tel:{{phoneNumber}}" id="phone-call-button-clickToCall" class="icon-phone menu-icon"></a></span></div><div class="names" ng-show="!feedback.showFeedback()" ng-style="companyColor"><span class="agent-name" ng-if="agent.agentName">{{getAgentName(agent) | uppercase}} {{"header.FROM" | translate}}</span> <span></span> <span class="agent-name" ng-if="!agent.agentName">{{ "header.WELCOME_TO" | translate}}</span> <span class="company-name" ng-style="isRTL(GLOBALS.companyName)">{{GLOBALS.companyName | uppercase}}</span></div><div ng-if="!agent.agentName" class="allAgentPanel" ng-style="allAgentsPanelWidth"><div ng-if="onlineAgentsList.length != null" ng-repeat="agent in onlineAgentsList | limitTo:3 track by $index" class="agent-img-container-small center" ng-style="photoBorderColor"><img ng-mouseenter="showInMessageCenter(agent.agentName)" class="agent-round-image-small" ng-src="{{getAgentPhotoUrl(agent.profilePicture,\'md\')}}"></div></div><div class="feedbackWrapper" ng-show="feedback.showFeedback()" ng-class="feedback.rank > 0 ? \'md-whiteframe-z1\' : \'\'"><div class="starWrapper"><span style="display: inline-block" ng-mouseenter="feedback.setStarHover(1)" ng-mouseleave="feedback.setStarHover(0)" ng-click="feedback.setRank(1)"><span class="star" id="star0" ng-class="feedback.starClass(0)"></span></span> <span style="display: inline-block" ng-mouseenter="feedback.setStarHover(2)" ng-mouseleave="feedback.setStarHover(0)" ng-click="feedback.setRank(2)"><span class="star" id="star1" ng-class="feedback.starClass(1)"></span></span> <span style="display: inline-block" ng-mouseenter="feedback.setStarHover(3)" ng-mouseleave="feedback.setStarHover(0)" ng-click="feedback.setRank(3)"><span class="star" id="star2" ng-class="feedback.starClass(2)"></span></span> <span style="display: inline-block" ng-mouseenter="feedback.setStarHover(4)" ng-mouseleave="feedback.setStarHover(0)" ng-click="feedback.setRank(4)"><span class="star" id="star3" ng-class="feedback.starClass(3)"></span></span> <span style="display: inline-block" ng-mouseenter="feedback.setStarHover(5)" ng-mouseleave="feedback.setStarHover(0)" ng-click="feedback.setRank(5)"><span class="star" id="star4" ng-class="feedback.starClass(4)"></span></span></div><div class="textAreaWrapper" ng-show="feedback.rankPressed"><textarea class="feedbackText" data-ng-model="feedback.feedbackText" maxlength="500" ng-keydown="feedback.checkSendText($event)" ng-attr-placeholder="{{\'feedback.TEXT_PLACEHOLDER\' | translate}}" ng-focus="feedback.clearTextPlaceholder()" ng-blur="feedback.setTextPlaceholder()"></textarea><input ng-hide="sentFeedback" value="{{\'feedback.SEND_BUTTON_TEXT\' | translate}}" class="sendFeedbackBtn" ng-class="feedback.isSendBtnDisabled ? \'disabled\' : \'\'" ng-disabled="feedback.isSendBtnDisabled" style="border-color: {{DISPLAY.mainColor}}; color: {{DISPLAY.mainColor}}" ng-click="feedback.sendFeedback(true)"> <input ng-hide="!sentFeedback" value="{{\'feedback.THANKS\' | translate}}" class="sendFeedbackBtn" ng-class="feedback.isSendBtnDisabled ? \'disabled\' : \'\'" ng-disabled="feedback.isSendBtnDisabled" style="border-color: {{DISPLAY.mainColor}}; color: {{DISPLAY.mainColor}}"></div></div></div></div><div video ng-show="GLOBALS.showVideoPanel"></div><div phone ng-show="GLOBALS.showPhonePanel"></div></div>'),$templateCache.put("directives/chat/chat.tpl.html",'<div id="chat-container-drv" class="chat-container" ng-class="{rtl: DISPLAY.language == \'he\' }" ng-style="viewModeStyle"><div class="state-change-animation"><div ng-click="closeChat()" id="close-chat-form" class="close-chat-form close-btn" ng-style="closeBtnStyle"><i id="close-chat-form-button" class="close-chat-form-button fa fa-close"></i></div><div id="chat-top" chat-top ng-style="chatTop"></div><div class="chat-body"><div id="chat-list" chat-list ng-style="chatList"></div><div id="chat-bottom" chat-bottom></div></div></div></div>'),$templateCache.put("directives/chat/mobile-chat-list.tpl.html","<span><div ng-repeat=\"message in msgs\" class=\"proonto-conversation-part\" ng-class=\"{'proonto-conversation-part-user':message.senderType==='CLIENT', 'proonto-conversation-part-admin':message.senderType==='AGENT','rtl': isRTL()}\"><div mobile-chat-message message=\"message\" ng-if=\"message.type=='TEXT'\"></div><div chat-contact-form ng-if=\"isMessageActionContactForm(message)\"></div></span>"),$templateCache.put("directives/chat/mobile-chat-message.tpl.html",'<div class="proonto-comment-container" ng-class="{\'proonto-comment-container-user\':message.senderType===\'CLIENT\', \'proonto-comment-container-admin\':message.senderType===\'AGENT\',\'rtl\': isRTL()}" ng-style="messageStyle(message);"><div class="proonto-comment"><div class="proonto-blocks"><div class="proonto-block proonto-block-paragraph">{{message.content}}</div></div></div></div><span></span>'),$templateCache.put("directives/chat/mobile-chat-top.tpl.html",'<div id="mobile-chat-top-drv" class="mobile-chat-top-container center"><div class="bordered-container" ng-style="borderedContainerStyle"><div class="agent-details"><div id="img-container" class="agent-img-container center" ng-style="photoBorderColor"><img ng-mouseenter="showInMessageCenter(agent.agentName)" class="agent-round-image" ng-src="{{agentProfilePhoto}}"></div>`<div class="names" ng-show="!feedback.showFeedback()" ng-class="{rtl: DISPLAY.language === \'he\'}" ng-style="companyColor"><span class="agent-name" ng-if="agent.agentName">{{getAgentName(agent) | uppercase}} {{"header.FROM" | translate}}</span> <span></span> <span class="agent-name" ng-if="!agent.agentName">{{ "header.WELCOME_TO" | translate}}</span> <span class="company-name" ng-style="isRTL(GLOBALS.companyName)">{{GLOBALS.companyName | uppercase}}</span></div><div class="feedbackWrapper" ng-show="feedback.showFeedback()" ng-class="feedback.rank > 0 ? \'md-whiteframe-z1\' : \'\'"><div class="starWrapper"><span style="display: inline-block" ng-mouseenter="feedback.setStarHover(1)" ng-mouseleave="feedback.setStarHover(0)" ng-click="feedback.setRank(1)"><span class="star" id="star0" ng-class="feedback.starClass(0)"></span></span> <span style="display: inline-block" ng-mouseenter="feedback.setStarHover(2)" ng-mouseleave="feedback.setStarHover(0)" ng-click="feedback.setRank(2)"><span class="star" id="star1" ng-class="feedback.starClass(1)"></span></span> <span style="display: inline-block" ng-mouseenter="feedback.setStarHover(3)" ng-mouseleave="feedback.setStarHover(0)" ng-click="feedback.setRank(3)"><span class="star" id="star2" ng-class="feedback.starClass(2)"></span></span> <span style="display: inline-block" ng-mouseenter="feedback.setStarHover(4)" ng-mouseleave="feedback.setStarHover(0)" ng-click="feedback.setRank(4)"><span class="star" id="star3" ng-class="feedback.starClass(3)"></span></span> <span style="display: inline-block" ng-mouseenter="feedback.setStarHover(5)" ng-mouseleave="feedback.setStarHover(0)" ng-click="feedback.setRank(5)"><span class="star" id="star4" ng-class="feedback.starClass(4)"></span></span></div><div class="textAreaWrapper" ng-show="feedback.rankPressed"><textarea class="feedbackText" data-ng-model="feedback.feedbackText" maxlength="500" ng-keydown="feedback.checkSendText($event)" ng-attr-placeholder="{{\'feedback.TEXT_PLACEHOLDER\' | translate}}" ng-focus="feedback.clearTextPlaceholder()" ng-blur="feedback.setTextPlaceholder()"></textarea><input ng-hide="sentFeedback" value="{{\'feedback.SEND_BUTTON_TEXT\' | translate}}" class="sendFeedbackBtn" ng-class="feedback.isSendBtnDisabled ? \'disabled\' : \'\'" ng-disabled="feedback.isSendBtnDisabled" style="border-color: {{DISPLAY.mainColor}}; color: {{DISPLAY.mainColor}}" ng-click="feedback.sendFeedback(true)"> <input ng-hide="!sentFeedback" value="{{\'feedback.THANKS\' | translate}}" class="sendFeedbackBtn" ng-class="feedback.isSendBtnDisabled ? \'disabled\' : \'\'" ng-disabled="feedback.isSendBtnDisabled" style="border-color: {{DISPLAY.mainColor}}; color: {{DISPLAY.mainColor}}"></div></div></div><div class="buttons"><span class="circle" ng-show="showPhoneButton" ng-style="circleColor" ng-mouseenter="showInMessageCenter(\'Ask for a phone call\')"><a href="tel:{{phoneNumber}}" id="phone-call-button-clickToCall" class="icon-phone menu-icon"></a></span></div></div></div>'),$templateCache.put("directives/chat/mobile-chat.tpl.html",'<div id="mobile-chat-container-drv" class="mobile-chat-container"><div id="proonto-container"><div data-reactroot="" class="proonto-messenger"><div class="proonto-messenger-background"></div><span><div class="proonto-conversation"><div class="proonto-header-buttons" ng-show="!GLOBALS.isKeyboardOpen"><div class="proonto-header-buttons-back"><div mobile-chat-top></div></div><div class="proonto-header-buttons-close"><div class="buttons"><span ng-style="circleColor" ng-click="closeChat()" id="close-chat-form" class="circle close-chat-form close-btn"><i id="close-chat-form-button" class="close-chat-form-button fa fa-close"></i></span></div></div></div><div class="proonto-conversation-body-container"><div class="proonto-conversation-backgrounds"><div class="proonto-conversation-background proonto-conversation-background-1"></div></div><div class="proonto-conversation-body proonto-conversation-body-snapped" style="bottom: -82px"><div class="proonto-conversation-body-parts" ng-style="keyboardOpenTop" style="bottom: 55px"><div class="proonto-conversation-body-parts-wrapper"><div class="proonto-conversation-parts proonto-conversation-parts-scrolled" mobile-chat-list></div></div></div></div><span></span></div><div class="proonto-conversation-footer"><div chat-bottom-mobile class="proonto-composer"></div></div></div></span></div></div></div>'),$templateCache.put("directives/chat/phone.tpl.html",'<div id="phone-panel-drv" class="phone-panel"><span class="fa fa-close" id="close-phone-panel" ng-click="closePhonePanel()" ng-mouseenter="showInMessageCenter(\'Close phone panel\')"></span><div class="title" ng-hide="calling"><span class="icon-phone"></span> <span class="font" ng-style="titleFontSize">{{\'phone.GET_A_FREE_CALL\' | translate}}</span></div><div id="submit-phone-call" class="phone-form center" ng-hide="calling"><i class="fa fa-close"></i> <i class="fa fa-check"></i> <input class="phone-input" placeholder="{{phonePlaceholder}}" maxlength="20"> <input id="submit" type="submit" value="{{\'phone.CALL_ME\' | translate}}" ng-click="startPhoneCall()" class="submitPhoneCall"></div><div class="calling" ng-show="calling"><div class="title"><span class="icon-phone"></span> CALLING...</div></div></div>'),$templateCache.put("directives/chat/video-drv.tpl.html",'<div id="video-panel-drv" class="widget-video-panel"><div class="video-streams"><div class="video-stream-container agent-video-stream" id="agent-stream" ng-style="agentVideoStreamStyle"><div class="waiting-for-agent" ng-style="waitingMsgStyle" ng-hide="isVideoConnected">{{waitingFor}}<br>{{waitingMsgAgentName}} <span class="three-dots-animation"><span class="one">.</span><span class="two">.</span><span class="three">.</span></span></div></div><div class="video-stream-container user-video-stream" id="publisher-stream" ng-style="userVideoStreamStyle"><div id="join-video-chat" ng-click="join()" ng-show="isJoinEnabled()" class="start-video-stream">JOIN!</div><div class="user-video-controls" ng-hide="video.micActive==undefined"><span id="client-video-chat-camera" ng-class="video.cameraActive ? \'icon icon-video\' : \'icon icon-no-video\'" ng-click="toggleCamera()" ng-mouseenter="showCamHoverMsg()"></span> <span id="client-video-chat-audio" ng-class="video.micActive ? \'icon icon-mic\' : \'icon icon-no-mic\'" ng-click="toggleMic()" ng-mouseenter="showMicHoverMsg()"></span></div></div></div><div class="agent-name-video" ng-style="companyColor" ng-if="agent.agentName">{{agent.agentName | uppercase}} {{"header.FROM" | translate}}&nbsp;{{GLOBALS.companyName | uppercase}}</div><div class="agent-name-video" ng-style="companyColor" ng-if="!agent.agentName">{{ "header.WELCOME_TO" | translate}}&nbsp;{{GLOBALS.companyName | uppercase}}</div></div>'),$templateCache.put("directives/invitation/invitation.tpl.html",'<div id="invitation-drv" class="state-change-animation invitation-container" ng-show="animateInvitation"><div class="img-container"><img class="agent-round-image" ng-style="invitationBorderColor" ng-src="{{agentProfilePhoto}}"></div><div class="invitation-body" ng-style="invitationBorderColor" ng-click="acceptInvitation()"><div class="invitation-text"><span calc-lang>{{invitationText}}</span></div><div id="accept-invitation" class="invitation-accept-button" ng-style="invitationButton" ng-click="acceptInvitation()">{{"invitation.LETS_CHAT" | translate}}</div><div id="close-invitation" class="invitation-decline-button" ng-click="closeInvitation()"></div></div></div>'),$templateCache.put("directives/state-machine.tpl.html",'<div online-welcome ng-if="display===DisplayForm.onlineEntrance" class="state-machine online-welcome"></div><div chat ng-if="display===DisplayForm.onlineChat && !GLOBALS.isMobileUA" class="state-machine chat-state"></div><div mobile-chat ng-if="display===DisplayForm.onlineChat && GLOBALS.isMobileUA" class="state-machine mobile-chat-state"></div><div invitation ng-if="display===DisplayForm.chatInvitation" class="state-machine invitation-state"></div><div contact-details ng-if="display===DisplayForm.contactDetails" class="state-machine contact-details" ng-class="{rtl: DISPLAY.language == \'he\' }"></div><div chat-lead ng-if="display===DisplayForm.chatLeadForm" class="state-machine contact-details"></div><div pacman-style ng-if="isPacmanEnabled(display)" class="state-machine proonto-pacman-main"></div>'),$templateCache.put("directives/welcome/chat-lead.tpl.html",'<div id="chat-lead-drv" ng-style="inlineStyle" class="state-change-animation scaleFromCornerAnimation" ng-show="showContactForm"><span ng-style="triangleStyle" class="arrow-right triangle"></span><div class="chat-lead" ng-show="showContent"><div id="close-chat-lead" ng-click="closeChatLeadForm()" class="closeBtn"><i class="fa fa-minus"></i></div><div class="title" ng-hide="sent"><span class="font" ng-style="titleFontSize">HELLO!</span></div><div class="subtitle" ng-hide="sent"><span class="font" ng-style="subTitleFontSize">Welcome to our live chat.<br>Introduce yourself & let us<br>know what you\'re after</span></div><form ng-submit="submit()" ng-hide="(submitStatus != submitStatusEnum.NOT_STARTED) || sent"><div class="row name"><i class="fa fa-close" ng-show="clientDetails.name.value.length === 0"></i> <i class="fa fa-check" ng-show="clientDetails.name.value.length > 0"></i> <input id="name" name="name" ng-model="clientDetails.name.value" class="form-control" ng-focus="setPlaceholder(\'name\', null)" ng-blur="setPlaceholder(\'name\', \'NAME\'); validateName()" maxlength="13" placeholder="{{clientDetails.name.placeholder}}"> <span class="pad-str">*</span></div><div class="row email"><i class="fa fa-close" ng-show="clientDetails.email.value != null && clientDetails.email.value.length != 0 && !validateEmailFormat(clientDetails.email.value);"></i> <i class="fa fa-check" ng-show="clientDetails.email.value != null && clientDetails.email.value.length != 0 && validateEmailFormat(clientDetails.email.value);"></i> <input id="email" name="email" ng-model="clientDetails.email.value" class="form-control" ng-focus="setPlaceholder(\'email\', null)" ng-blur="setPlaceholder(\'email\', \'EMAIL\'); validateEmail()" placeholder="{{clientDetails.email.placeholder}}"> <span class="pad-str">*</span></div><div class="row phone"><i class="fa fa-close" ng-show="!validatePhone()"></i> <i class="fa fa-check" ng-show="isShowPhoneCheck()"></i> <input id="phone" name="phone" ng-model="clientDetails.phone.value" class="form-control" type="tel" ng-focus="setPlaceholder(\'phone\', null)" ng-blur="setPlaceholder(\'phone\', \'PHONE\'); validatePhone()" placeholder="{{clientDetails.phone.placeholder}}"></div><input id="submit-pre-chat-lead" type="submit" value="LET\'S CHAT!" ng-class="isActive() ? \'active\' : \'\'"></form><div class="chat-lead-success" ng-show="sent"><i class="fa fa-check"></i></div></div></div>'),
$templateCache.put("directives/welcome/contact-details.tpl.html",'<div id="contact-details-drv" ng-style="contactStyle" class="state-change-animation scaleFromCornerAnimation" ng-show="showContactForm"><span ng-style="triangleStyle" class="arrow-right triangle"></span><div class="contact-us-no-agent" ng-show="showContent"><div id="close-contact-form-button" ng-click="closeContactUsForm()" class="closeBtn close-chat-form-button"><i class="fa fa-minus"></i></div><form ng-submit="submit()" ng-hide="submitStatus != submitStatusEnum.NOT_STARTED"><div class="title"><span calc-lang class="font" ng-style="titleFontSize">{{contactUsTitle}}</span></div><div class="subtitle"><span calc-lang class="font" ng-style="subTitleFontSize">{{contactUsSubTitle}}</span></div><div class="row name"><i class="fa fa-close" ng-show="clientDetails.name.value.length === 0"></i> <i class="fa fa-check" ng-show="clientDetails.name.value.length > 0"></i> <input tabindex="0" id="name" name="name" ng-model="clientDetails.name.value" class="form-control" ng-focus="setPlaceholder(\'name\', null); sendFocus($event);" ng-blur="setPlaceholder(\'name\', \'NAME\'); validateName();  sendBlur($event);" placeholder="{{clientDetails.name.placeholder}}"> <span class="pad-str">*</span></div><div class="row email"><i class="fa fa-close" ng-show="clientDetails.email.value != null && clientDetails.email.value.length != 0 && !validateEmailFormat(clientDetails.email.value);"></i> <i class="fa fa-check" ng-show="clientDetails.email.value != null && clientDetails.email.value.length != 0 && validateEmailFormat(clientDetails.email.value);"></i> <input tabindex="0" id="email" name="email" ng-model="clientDetails.email.value" class="form-control" ng-focus="setPlaceholder(\'email\', null); sendFocus($event);" ng-blur="setPlaceholder(\'email\', \'EMAIL\'); validateEmail();   sendBlur($event);" placeholder="{{clientDetails.email.placeholder}}"> <span class="pad-str">*</span></div><div class="row phone"><i class="fa fa-close" ng-show="!validatePhone()"></i> <i class="fa fa-check" ng-show="isShowPhoneCheck()"></i> <input tabindex="0" id="phone" name="phone" ng-model="clientDetails.phone.value" class="form-control" type="tel" ng-focus="setPlaceholder(\'phone\', null); sendFocus($event);" ng-blur="setPlaceholder(\'phone\', \'PHONE\'); validatePhone();   sendBlur($event);" placeholder="{{clientDetails.phone.placeholder}}"></div><div class="row msg"><i class="fa fa-close" ng-show="clientDetails.msg.value.length === 0"></i> <i class="fa fa-check" ng-show="clientDetails.msg.value != null && clientDetails.msg.value.length > 0"></i><textarea tabindex="0" id="msg" name="msg" ng-model="clientDetails.msg.value" class="form-control" ng-focus="setPlaceholder(\'msg\', null); sendFocus($event);" ng-blur="setPlaceholder(\'msg\', \'MESSAGE\'); validateMsg();   sendBlur($event);" placeholder="{{clientDetails.msg.placeholder}}" maxlength="1000"></textarea><span class="pad-str">*</span></div><input id="submit-contact-details" type="submit" value="{{clientDetails.send.placeholder}}" style="margin-top: 1px" ng-class="isActive() ? \'active\' : \'\'"></form><span ng-hide="submitStatus == submitStatusEnum.NOT_STARTED" class="response"><div ng-if="submitStatus == submitStatusEnum.SUCCESS"><i class="fa fa-check"></i></div><div ng-if="submitStatus == submitStatusEnum.FAILURE"><div>Something went wrong!</div><div>Please reload the page</div><div>or contact support</div></div></span></div></div>'),$templateCache.put("directives/welcome/online-welcome.tpl.html",'<div id="online-welcome-drv" ng-click="openChat()" class="state-change-animation CTA-animation"><span class="icon-blurbynew2" ng-style="ctaButtonStyle" ng-if="shape === \'classic\'"></span> <span class="icon-blurbynew" ng-style="ctaButtonStyle2" ng-if="shape === \'classic\'"></span><div id="CTA-button " class="CTA-button cta-text" ng-class="[onlineOfflineClass, isRTL]" ng-if="shape === \'classic\'"><span class="CTA-span desktop" ng-if="isDesktopScreen()" data-fittext data-fittext-min="12px" data-fittext-max="19px" style="font-weight:600">{{ctaText}}</span> <span class="CTA-span mobile" ng-if="!isDesktopScreen()">{{ctaText}}</span></div><div ng-if="shape !== \'classic\'" class="custom {{blink}}" ng-class="[shape, isRTL]" ng-style="customButtonStyle"><span class="s {{\'s-\'+symbol}}" ng-class="{\'emptyCTA\': ctaText === \'\'}" ng-if="!agentProfilePhoto || agentProfilePhoto === \'assets/avatar.png\'"></span> <img class="s agentPic" ng-if="agentProfilePhoto !== \'assets/avatar.png\'" ng-src="{{agentProfilePhoto}}" style="border: 1px solid {{DISPLAY.textColor}}"><div class="{{badge}}" ng-if="badgeValue > 0">{{badgeValue}}</div><span ng-show="ctaText !== \'\'" class="ctaText" id="ctaText" ng-class="[onlineOfflineClass, isRTL]">{{ctaText}}</span></div></div>'),$templateCache.put("directives/welcome/pacman-style.tpl.html",'<div id="pacman-drv" class="state-change-animation"><div ng-class="pacmanClass" ng-hide="!showPacman()"><span ng-click="openChat()" ng-style="pacmanStyle" class="icon-proonterE pacman-animation"></span></div><div id="img-container" class="agent-img-container center" ng-style="photoBorderColor" ng-hide="showPacman()"><img class="agent-round-image" ng-src="{{agentProfilePhoto}}"></div></div>')}]);